{"version":3,"sources":["webpack://ENABLE3D/webpack/universalModuleDefinition","webpack://ENABLE3D/webpack/bootstrap","webpack://ENABLE3D/external \"THREE\"","webpack://ENABLE3D/../common/dist/logger.js","webpack://ENABLE3D/./node_modules/eventemitter3/index.js","webpack://ENABLE3D/../common/dist/extendedObject3D.js","webpack://ENABLE3D/../common/dist/applyMixins.js","webpack://ENABLE3D/../common/dist/extendedMesh.js","webpack://ENABLE3D/../common/dist/defaultMaterial.js","webpack://ENABLE3D/../common/dist/physicsLoader.js","webpack://ENABLE3D/../common/dist/types.js","webpack://ENABLE3D/../common/dist/physicsBody.js","webpack://ENABLE3D/../common/dist/factories.js","webpack://ENABLE3D//home/yannick/enable3d/node_modules/eventemitter3/index.js","webpack://ENABLE3D/../common/dist/wasmLoader.js","webpack://ENABLE3D/./src/convexObjectBreaker.ts","webpack://ENABLE3D/./src/shapes.ts","webpack://ENABLE3D/./src/constraints.ts","webpack://ENABLE3D/./src/events.ts","webpack://ENABLE3D/./src/debugDrawer.ts","webpack://ENABLE3D/./src/physics.ts","webpack://ENABLE3D/./src/three-to-ammo.js","webpack://ENABLE3D/./src/torusShape.ts","webpack://ENABLE3D/./src/raycaster/closestRayResultCallback.ts","webpack://ENABLE3D/./src/raycaster/allHitsRayResultCallback.ts","webpack://ENABLE3D/./src/raycaster/raycaster.ts","webpack://ENABLE3D/./src/lib/Clock.ts","webpack://ENABLE3D/./src/index.ts","webpack://ENABLE3D/./src/bundle.ts"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","default","msg","console","error","has","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","__proto__","eventNames","events","names","slice","getOwnPropertySymbols","concat","listeners","handlers","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","extendStatics","__extends","b","setPrototypeOf","__","constructor","__importDefault","mod","index_1","logger_1","ExtendedObject3D","_super","_this","vector3","Vector3","hasBody","anims","currentAnimation","id","theta","worldTheta","phi","worldPhi","configurable","getWorldDirection","Math","atan2","x","z","acos","y","setAction","_a","mixer","action","clipAction","time","stopAllAction","fadeIn","play","Object3D","derivedCtor","baseCtors","forEach","baseCtor","getOwnPropertyNames","getOwnPropertyDescriptor","ExtendedMesh","geometry","material","Mesh","DefaultMaterial","_defaultMaterial","MeshLambertMaterial","color","wasmLoader_1","PhysicsLoader","path","callback","__loadPhysics","Ammo","then","extendedObject3D_1","extendedMesh_1","AnimationMixer","AnimationClip","AnimationAction","Material","Line","Points","Group","eventemitter3_1","PhysicsBody","physics","ammo","offset","errors","checkCollisions","breakable","collided","didUpdate","_emitUpdateEvents","_needUpdate","tmpEuler","Euler","tmpQuaternion","Quaternion","tmpBtVector3","btVector3","tmpBtVector3_1","tmpBtQuaternion","btQuaternion","destructor","eventEmitter","destroy","setupEventEmitter","set","need","onUpdateEvent","updateCallback","update","collision","collisionCallback","onCollision","data","bodies","transform","tmpTrans","getMotionState","getWorldTransform","refresh","setWorldTransform","setRotation","e","q","setFromEuler","setValue","ammoQuat","w","getRotation","qx","qy","qz","qw","angle","sqrt","setPosition","getOrigin","getLinearVelocity","getAngularVelocity","setVelocity","setLinearVelocity","setVelocityX","velocity","setVelocityY","setVelocityZ","setAngularVelocity","setAngularVelocityX","angularVelocity","setAngularVelocityY","setAngularVelocityZ","applyForce","applyCentralImpulse","applyForceX","applyForceY","applyForceZ","applyCentralForce","applyCentralLocalForce","applyImpulse","impulse","relativePosition","applyLocalTorque","applyTorque","applyTorqueImpulse","setCollisionFlags","getCollisionFlags","setRestitution","setBounciness","setFriction","setGravity","setLinearFactor","setAngularFactor","setCcdMotionThreshold","threshold","setCcdSweptSphereRadius","radius","__assign","assign","__rest","indexOf","propertyIsEnumerable","defaultMaterial_1","Factories","scene","isHeadless","defaultMaterial","plane","planeConfig","materialConfig","makePlane","box","boxConfig","makeBox","sphere","sphereConfig","makeSphere","cylinder","cylinderConfig","makeCylinder","cone","coneConfig","makeCone","torus","torusConfig","makeTorus","extrude","extrudeConfig","makeExtrude","mesh","addMesh","existing","addExisting","addPlane","addBox","ground","groundConfig","addGround","addSphere","addCylinder","addCone","addTorus","addExtrude","addMaterial","_i","add","isArray","createMesh","position","obj","_b","_c","type","castShadow","receiveShadow","shape","autoCenter","bufferGeometry","rest","_d","depth","_e","bevelEnabled","ExtrudeBufferGeometry","ExtrudeGeometry","center","PlaneBufferGeometry","width","height","widthSegments","heightSegments","PlaneGeometry","side","DoubleSide","SphereBufferGeometry","phiStart","phiLength","thetaStart","thetaLength","SphereGeometry","BoxBufferGeometry","depthSegments","BoxGeometry","rotateX","MathUtils","degToRad","CylinderBufferGeometry","radiusTop","radiusBottom","radiusSegments","openEnded","CylinderGeometry","ConeBufferGeometry","PI","TorusBufferGeometry","tube","radialSegments","tubularSegments","arc","TorusGeometry","keys","MeshBasicMaterial","basic","MeshNormalMaterial","normal","MeshStandardMaterial","standard","lambert","MeshPhongMaterial","phong","physical","MeshPhysicalMaterial","MeshToonMaterial","toon","LineBasicMaterial","line","PointsMaterial","points","custom","wasmSupported","WebAssembly","instantiate","module_1","Module","Uint8Array","of","Instance","loadScriptAsync","url","doneCallback","tag","document","createElement","onload","onerror","Error","async","src","head","appendChild","v1","objectsAmmo","config","mass","collisionFlags","translateX","toAmmoV3","v","lock","body","targetBody","fixed","pointToPoint","hinge","slider","spring","coneTwist","bodyA","bodyB","frameA","frameB","dof","getTransform","v2","dx","dy","dz","transformB","btTransform","setIdentity","transformA","setOrigin","getCenterOfMassTransform","inverse","op_mul","zero","angularLowerLimit","angularUpperLimit","constraint","btFixedConstraint","physicsWorld","addConstraint","pivotA","pivotB","pivotV3","targetPivotV3","btPoint2PointConstraint","axisA","axisB","axisV3","targetAxisV3","btHingeConstraint","linearLowerLimit","linearUpperLimit","rotationA","setEulerZYX","rotationB","btSliderConstraint","setLowerLinLimit","lll","setUpperLinLimit","lul","setLowerAngLimit","all","setUpperAngLimit","aul","stiffness","damping","angularLock","btGeneric6DofSpringConstraint","setLinearLowerLimit","setLinearUpperLimit","setAngularLowerLimit","setAngularUpperLimit","enableSpring","setStiffness","setDamping","rbAFrame","rbBFrame","btConeTwistConstraint","setAngularOnly","btGeneric6DofConstraint","addCollider","object1","object2","eventCallback","AmmoDebugConstants","world","options","debugDrawMode","drawOnTop","maxBufferSize","vertices","Float32Array","colors","setAttribute","setUsage","index","vertexColors","depthTest","renderOrder","frustumCulled","enabled","debugDrawer","DebugDrawer","drawLine","drawContactPoint","reportErrorWarning","draw3dText","setDebugMode","getDebugMode","setDebugDrawer","enable","disable","remove","attributes","needsUpdate","debugDrawWorld","setDrawRange","from","to","heap","HEAPF32","g","fromX","fromY","fromZ","setXYZ","toX","toY","toZ","pointOnB","normalOnB","distance","_lifeTime","warningString","warn","Pointer_stringify","warnedOnce","_location","_textString","debugMode","ConvexObjectBreaker","minSizeForBreak","smallDelta","tempLine1","tempPlane1","tempPlane2","tempPlane_Cut","tempCM1","tempCM2","tempVector3","tempVector3_2","tempVector3_3","tempVector3_P0","tempVector3_P1","tempVector3_P2","tempVector3_N0","tempVector3_N1","tempVector3_AB","tempVector3_CB","tempResultObjects","segments","prepareBreakableObject","isBufferGeometry","userData","clone","subdivideByImpact","pointOfImpact","maxRadialIterations","maxRandomIterations","debris","addVectors","setFromCoplanarPoints","maxTotalIterations","scope","subdivideRadial","subObject","startAngle","endAngle","numIterations","random","copy","constant","sub","applyAxisAngle","cutByPlane","obj1","obj2","output","coords","array","normals","numPoints","numFaces","indices","getIndex","getVertexIndex","faceIdx","vert","idx","points1","points2","delta","numPointPairs","p0","p1","n0","n1","b1","c1","b2","c2","dot","localPlane","updateMatrix","transformPlaneToLocalSpace","matrix","va","vb","vc","segment","i0","i1","mark0","distanceToPoint","mark1","start","end","intersection","intersectLine","segmentedObject1","segmentedObject2","newMass","radius1","numPoints1","divideScalar","max","radius2","numPoints2","numObjects","quaternion","transformFreeVector","elements","transformFreeVectorInverse","transformTiedVectorInverse","resultPlane","referencePoint","coplanarPoint","rigidBodies","earlierDetectedCollisions","includes","ptr","values","removeRigidBody","splice","setup","convexBreaker","objectsToRemove","numObjectsToRemove","setupPhysicsWorld","updateDebugger","gravity","collisionConfiguration","btDefaultCollisionConfiguration","dispatcher","btCollisionDispatcher","broadphase","btDbvtBroadphase","solver","btSequentialImpulseConstraintSolver","btDiscreteDynamicsWorld","createDebrisFromBreakableObject","parent","fragmentDepth","setTimeout","removeDebris","impactPoint","impactNormal","detectedCollisions","deltaTime","stepSimulation","maxSubSteps","fixedTimeStep","il","objThree","ms","isKinematicObject","needUpdate","getWorldQuaternion","getWorldPosition","tmpVector3","contactPoint","pos","vel","angVel","fragment","contactManifold","getManifoldByIndexInternal","getBody0","body0","castObject","btRigidBody","body1","getBody1","ptr0","ptr1","threeObject0","threeObject1","breakable0","breakable1","collided0","collided1","checkCollisions0","checkCollisions1","sort","find","el","combinedName","contact","maxImpulse","jl","getNumContacts","getContactPoint","getDistance","getAppliedImpulse","get_m_positionWorldOnB","get_m_normalWorldOnB","emptyV3","physicsBody","getNumManifolds","split","obj0","TYPE","FIT","hasUpdateMatricesFunction","createCollisionShapes","createBoxShape","createCylinderShape","createCapsuleShape","createConeShape","createSphereShape","createHullShape","createHACDShapes","createVHACDShapes","createTriMeshShape","createHeightfieldTerrainShape","_setOptions","fit","halfExtents","_computeHalfExtents","_computeBounds","minHalfExtent","maxHalfExtent","btHalfExtents","collisionShape","btBoxShape","_finishCollisionShape","_computeScale","cylinderAxis","btCylinderShape","btCylinderShapeX","btCylinderShapeZ","btCapsuleShape","btCapsuleShapeX","btCapsuleShapeZ","btConeShape","btConeShapeX","btConeShapeZ","isNaN","sphereRadius","_computeRadius","btSphereShape","vertex","bounds","btVertex","originalHull","btConvexHullShape","setMargin","margin","min","multiplyScalar","vertexCount","_iterateGeometries","geo","maxVertices","hullMaxVertices","adjustGeometryTranslateEXPERIMENTAL","components","applyMatrix4","addPoint","getNumVertices","shapeHull","btShapeHull","buildHull","getPointer","getVertexPointer","numVertices","scale","triCount","hacd","HACD","SetCompacityWeight","compacityWeight","SetVolumeWeight","volumeWeight","SetNClusters","nClusters","SetNVerticesPerCH","nVerticesPerCH","SetConcavity","concavity","_malloc","triangles","SetPoints","SetTriangles","SetNPoints","SetNTriangles","pptr","tptr","HEAPF64","HEAP32","Compute","_free","GetNClusters","shapes","hull","nPoints","GetNPointsCH","nTriangles","GetNTrianglesCH","hullPoints","hullTriangles","GetCH","pi","px","py","pz","count","vhacd","VHACD","params","Parameters","set_m_resolution","resolution","set_m_depth","set_m_concavity","set_m_planeDownsampling","planeDownsampling","set_m_convexhullDownsampling","convexhullDownsampling","set_m_alpha","alpha","set_m_beta","beta","set_m_gamma","gamma","set_m_pca","pca","set_m_mode","set_m_maxNumVerticesPerCH","maxNumVerticesPerCH","set_m_minVolumePerCH","minVolumePerCH","set_m_convexhullApproximation","convexhullApproximation","set_m_oclAcceleration","oclAcceleration","nHulls","GetNConvexHulls","ch","ConvexHull","GetConvexHull","get_m_nPoints","get_m_points","bta","btb","btc","triMesh","btTriangleMesh","ai","bi","ci","addTriangle","concave","btBvhTriangleMeshShape","btConvexTriangleMeshShape","resources","heightfieldDistance","heightfieldData","heightScale","upAxis","hdt","heightDataType","PHY_SHORT","PHY_FLOAT","flipQuadEdges","heightStickLength","heightStickWidth","minHeight","Number","POSITIVE_INFINITY","maxHeight","NEGATIVE_INFINITY","btHeightfieldTerrainShape","setLocalScaling","includeInvisible","orientation","res","localScale","cb","getInverse","matrixWorld","traverse","isMesh","identity","updateMatrices","multiplyMatrices","fromGeometry","maxRadiusSq","cx","cy","cz","getCenter","subVectors","clampScalar","minX","Infinity","minY","minZ","maxX","maxY","maxZ","computeBoundingBox","target","boundingBox","makeTranslation","getHitPointWorld","h","_btRayCallback","get_m_hitPointWorld","getCollisionObject","get_m_collisionObject","size","hh","at","getCollisionObjects","obs","get_m_collisionObjects","setRayFromWorld","_btRayFrom","set_m_rayFromWorld","setRayToWorld","_btRayTo","set_m_rayToWorld","hasHit","rayTest","_tmpBtVector3","ClosestRayResultCallback","AllHitsRayResultCallback","ClosestRaycaster","Raycaster","AllHitsRaycaster","autoStart","startTime","oldTime","elapsedTime","running","performance","Date","now","stop","getElapsedTime","getDelta","diff","newTime","version","log","collider","constraints","addConstraints","raycaster","prepareThreeObjectForCollisionShape","defaultParams","test","parameters","createCollisionShape","quat","SIMD_PI","subdivisions","gap","cos","cylinderShape","compoundShape","btCompoundShape","forward","rotation","rotate","addChildShape","addTorusShape","mergeCollisionShapesToCompoundShape","collisionShapes","compound","addChildren","map","collisionShapeToRigidBody","addRigidBodyToWorld","cs","children","child","rigidBody","addRigidBody","physicsShape","motionState","btDefaultMotionState","localInertia","calculateLocalInertia","rbInfo","btRigidBodyConstructionInfo","setActivationState"],"mappings":"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","file":"enable3d.ammoPhysics.0.18.0-alpha.0.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"THREE\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"THREE\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ENABLE3D\"] = factory(require(\"THREE\"));\n\telse\n\t\troot[\"ENABLE3D\"] = factory(root[\"THREE\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 13);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar logger = function (msg) {\n    console.error(\"%c [enable3d] \" + msg + \" \", 'background: #222; color: #bada55');\n};\nexports.default = logger;\n//# sourceMappingURL=logger.js.map","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar logger_1 = __importDefault(require(\"./logger\"));\n/**\n * Extends the Object3D class from THREE.js and implements properties from Line, Mesh and Points.\n */\nvar ExtendedObject3D = /** @class */ (function (_super) {\n    __extends(ExtendedObject3D, _super);\n    function ExtendedObject3D() {\n        var _this = _super.call(this) || this;\n        _this.vector3 = new index_1.Vector3();\n        _this.hasBody = false;\n        _this.anims = {};\n        _this.currentAnimation = '';\n        _this.name = \"object-\" + _this.id;\n        return _this;\n    }\n    Object.defineProperty(ExtendedObject3D.prototype, \"world\", {\n        /** Returns all values relative to the world. */\n        get: function () {\n            return {\n                theta: this.worldTheta,\n                phi: this.worldPhi\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtendedObject3D.prototype, \"worldTheta\", {\n        /** Get the theta relative to the world. */\n        get: function () {\n            this.getWorldDirection(this.vector3);\n            return Math.atan2(this.vector3.x, this.vector3.z);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtendedObject3D.prototype, \"worldPhi\", {\n        /** Get the phi relative to the world. */\n        get: function () {\n            this.getWorldDirection(this.vector3);\n            return Math.acos(this.vector3.y);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExtendedObject3D.prototype.setAction = function (name) {\n        var _a;\n        if (this.mixer && this.anims.hasOwnProperty(name)) {\n            var action = (_a = this.mixer) === null || _a === void 0 ? void 0 : _a.clipAction(this.anims[name]);\n            action.time = 0;\n            this.mixer.stopAllAction();\n            action.fadeIn(0.5);\n            action.play();\n            this.currentAnimation = name;\n        }\n        else {\n            logger_1.default(\"[Phaser3D] Can't set animation \" + name);\n        }\n    };\n    return ExtendedObject3D;\n}(index_1.Object3D));\nexports.ExtendedObject3D = ExtendedObject3D;\nexports.default = ExtendedObject3D;\n//# sourceMappingURL=extendedObject3D.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// https://www.typescriptlang.org/docs/handbook/mixins.html\nvar applyMixins = function (derivedCtor, baseCtors) {\n    baseCtors.forEach(function (baseCtor) {\n        Object.getOwnPropertyNames(baseCtor.prototype).forEach(function (name) {\n            // @ts-ignore\n            Object.defineProperty(derivedCtor.prototype, name, Object.getOwnPropertyDescriptor(baseCtor.prototype, name));\n        });\n    });\n};\nexports.default = applyMixins;\n//# sourceMappingURL=applyMixins.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar logger_1 = __importDefault(require(\"./logger\"));\nvar ExtendedMesh = /** @class */ (function (_super) {\n    __extends(ExtendedMesh, _super);\n    function ExtendedMesh(geometry, material) {\n        var _this = _super.call(this, geometry, material) || this;\n        _this.vector3 = new index_1.Vector3();\n        _this.hasBody = false;\n        _this.anims = {};\n        _this.currentAnimation = '';\n        _this.name = \"object-\" + _this.id;\n        return _this;\n    }\n    Object.defineProperty(ExtendedMesh.prototype, \"world\", {\n        /** Returns all values relative to the world. */\n        get: function () {\n            return {\n                theta: this.worldTheta,\n                phi: this.worldPhi\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtendedMesh.prototype, \"worldTheta\", {\n        /** Get the theta relative to the world. */\n        get: function () {\n            this.getWorldDirection(this.vector3);\n            return Math.atan2(this.vector3.x, this.vector3.z);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ExtendedMesh.prototype, \"worldPhi\", {\n        /** Get the phi relative to the world. */\n        get: function () {\n            this.getWorldDirection(this.vector3);\n            return Math.acos(this.vector3.y);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ExtendedMesh.prototype.setAction = function (name) {\n        var _a;\n        if (this.mixer && this.anims.hasOwnProperty(name)) {\n            var action = (_a = this.mixer) === null || _a === void 0 ? void 0 : _a.clipAction(this.anims[name]);\n            action.time = 0;\n            this.mixer.stopAllAction();\n            action.fadeIn(0.5);\n            action.play();\n            this.currentAnimation = name;\n        }\n        else {\n            logger_1.default(\"[Phaser3D] Can't set animation \" + name);\n        }\n    };\n    return ExtendedMesh;\n}(index_1.Mesh));\nexports.ExtendedMesh = ExtendedMesh;\n//# sourceMappingURL=extendedMesh.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar DefaultMaterial = /** @class */ (function () {\n    function DefaultMaterial() {\n        this._defaultMaterial = new index_1.MeshLambertMaterial({ color: 0xcccccc });\n    }\n    DefaultMaterial.prototype.get = function () {\n        return this._defaultMaterial;\n    };\n    return DefaultMaterial;\n}());\nexports.default = DefaultMaterial;\n//# sourceMappingURL=defaultMaterial.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar wasmLoader_1 = __importDefault(require(\"./wasmLoader\"));\nvar PhysicsLoader = function (path, callback) {\n    if (typeof window !== 'undefined')\n        window.__loadPhysics = true;\n    wasmLoader_1.default(path, function () {\n        Ammo().then(function () {\n            callback();\n        });\n    });\n};\nexports.PhysicsLoader = PhysicsLoader;\n//# sourceMappingURL=physicsLoader.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar extendedObject3D_1 = require(\"./extendedObject3D\");\nexports.ExtendedObject3D = extendedObject3D_1.ExtendedObject3D;\nvar extendedMesh_1 = require(\"./extendedMesh\");\nexports.ExtendedMesh = extendedMesh_1.ExtendedMesh;\n// TODO fix this export\n// export { ThirdPersonControls } from '../misc/thirdPersonControls'\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nexports.AnimationMixer = index_1.AnimationMixer;\nexports.AnimationClip = index_1.AnimationClip;\nexports.AnimationAction = index_1.AnimationAction;\nexports.Object3D = index_1.Object3D;\nexports.Mesh = index_1.Mesh;\nexports.Material = index_1.Material;\nexports.Line = index_1.Line;\nexports.Points = index_1.Points;\nexports.Group = index_1.Group;\n//# sourceMappingURL=types.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar eventemitter3_1 = __importDefault(require(\"eventemitter3\"));\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar PhysicsBody = /** @class */ (function () {\n    function PhysicsBody(physics, ammo) {\n        this.physics = physics;\n        this.ammo = ammo;\n        this.offset = { x: 0, y: 0, z: 0 };\n        this.errors = [];\n        this.checkCollisions = false;\n        this.breakable = false;\n        this.collided = false;\n        this.didUpdate = false;\n        this._emitUpdateEvents = false;\n        this._needUpdate = false;\n        this.tmpEuler = new index_1.Euler();\n        this.tmpQuaternion = new index_1.Quaternion();\n        this.tmpBtVector3 = new Ammo.btVector3();\n        this.tmpBtVector3_1 = new Ammo.btVector3();\n        this.tmpBtQuaternion = new Ammo.btQuaternion(0, 0, 0, 1);\n        // @ts-ignore\n        this.name = ammo.name;\n    }\n    /**\n     * Don't call this manually! Do physics.destroy() instead.\n     */\n    PhysicsBody.prototype.destructor = function () {\n        // remove events\n        if (this.eventEmitter)\n            this.eventEmitter.removeAllListeners();\n        // destroy tmp ammo values\n        Ammo.destroy(this.tmpBtVector3);\n        Ammo.destroy(this.tmpBtVector3_1);\n        Ammo.destroy(this.tmpBtQuaternion);\n    };\n    PhysicsBody.prototype.setupEventEmitter = function () {\n        if (typeof this.eventEmitter === 'undefined')\n            this.eventEmitter = new eventemitter3_1.default();\n    };\n    Object.defineProperty(PhysicsBody.prototype, \"needUpdate\", {\n        get: function () {\n            return this._needUpdate;\n        },\n        set: function (need) {\n            if (!need && this._needUpdate)\n                this.didUpdate = true;\n            this._needUpdate = need;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    PhysicsBody.prototype.onUpdateEvent = function (updateCallback, once) {\n        if (once === void 0) { once = false; }\n        this.setupEventEmitter();\n        this._emitUpdateEvents = true;\n        if (once)\n            this.eventEmitter.once('update', function () {\n                updateCallback();\n            });\n        else\n            this.eventEmitter.on('update', function () {\n                updateCallback();\n            });\n    };\n    Object.defineProperty(PhysicsBody.prototype, \"on\", {\n        get: function () {\n            var _this = this;\n            return {\n                update: function (updateCallback) { return _this.onUpdateEvent(updateCallback); },\n                collision: function (collisionCallback) {\n                    return _this.onCollision(collisionCallback);\n                }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(PhysicsBody.prototype, \"once\", {\n        get: function () {\n            var _this = this;\n            return {\n                update: function (updateCallback) { return _this.onUpdateEvent(updateCallback, true); }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    PhysicsBody.prototype.onCollision = function (collisionCallback) {\n        var _this = this;\n        this.checkCollisions = true;\n        this.physics.on('collision', function (data) {\n            var bodies = data.bodies, event = data.event;\n            if (bodies[0].name === _this.name)\n                collisionCallback(bodies[1], event);\n            else if (bodies[1].name === _this.name)\n                collisionCallback(bodies[0], event);\n        });\n    };\n    /** You have to call transform() before you can get or set the body's position or rotation. (for headless mode only) */\n    PhysicsBody.prototype.transform = function () {\n        var t = this.physics.tmpTrans;\n        this.ammo.getMotionState().getWorldTransform(t);\n    };\n    /** You have to call refresh() after you set the position or rotation of the body. (for headless mode only) */\n    PhysicsBody.prototype.refresh = function () {\n        var t = this.physics.tmpTrans;\n        this.ammo.getMotionState().setWorldTransform(t);\n    };\n    /** Set the rotation in radians. (for headless mode only) */\n    PhysicsBody.prototype.setRotation = function (x, y, z) {\n        var e = this.tmpEuler.set(x, y, z);\n        var q = this.tmpQuaternion.set(0, 0, 0, 1);\n        q.setFromEuler(e);\n        this.tmpBtQuaternion.setValue(0, 0, 0, 1);\n        var ammoQuat = this.tmpBtQuaternion;\n        ammoQuat.setValue(q.x, q.y, q.z, q.w);\n        var t = this.physics.tmpTrans;\n        t.setRotation(ammoQuat);\n    };\n    Object.defineProperty(PhysicsBody.prototype, \"rotation\", {\n        /** Get the rotation in radians. (for headless mode only) */\n        get: function () {\n            var t = this.physics.tmpTrans;\n            var ammoQuat = t.getRotation();\n            var q = this.tmpQuaternion.set(ammoQuat.x(), ammoQuat.y(), ammoQuat.z(), ammoQuat.w());\n            var qx = q.x;\n            var qy = q.y;\n            var qz = q.z;\n            var qw = q.w;\n            // https://www.euclideanspace.com/maths/geometry/rotations/conversions/quaternionToAngle/index.htm\n            var angle = 2 * Math.acos(qw);\n            var x = qx / Math.sqrt(1 - qw * qw);\n            var y = qy / Math.sqrt(1 - qw * qw);\n            var z = qz / Math.sqrt(1 - qw * qw);\n            return { x: x * angle || 0, y: y * angle || 0, z: z * angle || 0 };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    /** Set position. (for headless mode only) */\n    PhysicsBody.prototype.setPosition = function (x, y, z) {\n        var t = this.physics.tmpTrans;\n        t.getOrigin().setValue(x, y, z);\n    };\n    Object.defineProperty(PhysicsBody.prototype, \"position\", {\n        /** Get position. (for headless mode only) */\n        get: function () {\n            var t = this.physics.tmpTrans;\n            return { x: t.getOrigin().x(), y: t.getOrigin().y(), z: t.getOrigin().z() };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(PhysicsBody.prototype, \"velocity\", {\n        get: function () {\n            return {\n                x: this.ammo.getLinearVelocity().x(),\n                y: this.ammo.getLinearVelocity().y(),\n                z: this.ammo.getLinearVelocity().z()\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(PhysicsBody.prototype, \"angularVelocity\", {\n        get: function () {\n            return {\n                x: this.ammo.getAngularVelocity().x(),\n                y: this.ammo.getAngularVelocity().y(),\n                z: this.ammo.getAngularVelocity().z()\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    PhysicsBody.prototype.setVelocity = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setVelocityX = function (value) {\n        this.tmpBtVector3.setValue(value, this.velocity.y, this.velocity.z);\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setVelocityY = function (value) {\n        this.tmpBtVector3.setValue(this.velocity.x, value, this.velocity.z);\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setVelocityZ = function (value) {\n        this.tmpBtVector3.setValue(this.velocity.x, this.velocity.y, value);\n        this.ammo.setLinearVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularVelocity = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularVelocityX = function (value) {\n        this.tmpBtVector3.setValue(value, this.angularVelocity.y, this.angularVelocity.z);\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularVelocityY = function (value) {\n        this.tmpBtVector3.setValue(this.angularVelocity.x, value, this.angularVelocity.z);\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularVelocityZ = function (value) {\n        this.tmpBtVector3.setValue(this.angularVelocity.x, this.angularVelocity.y, value);\n        this.ammo.setAngularVelocity(this.tmpBtVector3);\n    };\n    // Apply Force methods\n    PhysicsBody.prototype.applyForce = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyForceX = function (value) {\n        this.tmpBtVector3.setValue(value, 0, 0);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyForceY = function (value) {\n        this.tmpBtVector3.setValue(0, value, 0);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyForceZ = function (value) {\n        this.tmpBtVector3.setValue(0, 0, value);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    // Apply \"Something\" Methods\n    PhysicsBody.prototype.applyCentralForce = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.applyCentralForce(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyCentralImpulse = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.applyCentralImpulse(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyCentralLocalForce = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.applyCentralLocalForce(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyImpulse = function (impulse, relativePosition) {\n        this.tmpBtVector3.setValue(impulse.x || 0, impulse.y || 0, impulse.z || 0);\n        this.tmpBtVector3_1.setValue(relativePosition.x || 0, relativePosition.y || 0, relativePosition.z || 0);\n        this.ammo.applyImpulse(this.tmpBtVector3, this.tmpBtVector3_1);\n    };\n    PhysicsBody.prototype.applyLocalTorque = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.applyLocalTorque(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyTorque = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.applyTorque(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.applyTorqueImpulse = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.applyTorqueImpulse(this.tmpBtVector3);\n    };\n    /**\n     * Add the collision flags\n     * @param value 0 is DYNAMIC, 1 is STATIC, 2 is KINEMATIC, 4 GHOST\n     */\n    // https://github.com/bulletphysics/bullet3/blob/aae8048722f2596f7e2bdd52d2a1dcb52a218f2b/src/BulletCollision/CollisionDispatch/btCollisionObject.h#L128\n    PhysicsBody.prototype.setCollisionFlags = function (value) {\n        this.ammo.setCollisionFlags(value);\n    };\n    /**\n     * Get the collision flags\n     * @param value 0 is DYNAMIC, 1 is STATIC, 2 is KINEMATIC, 4 GHOST\n     */\n    PhysicsBody.prototype.getCollisionFlags = function () {\n        return this.ammo.getCollisionFlags();\n    };\n    /**\n     * Set the restitution (same as bounciness)\n     * @param value A number from 0 to 1.\n     */\n    PhysicsBody.prototype.setRestitution = function (value) {\n        this.ammo.setRestitution(value);\n    };\n    /**\n     * Set the bounciness (same as restitution)\n     * @param value A number from 0 to 1.\n     */\n    PhysicsBody.prototype.setBounciness = function (value) {\n        this.setRestitution(value);\n    };\n    /**\n     * Set the friction\n     * @param value A number from 0 to 1.\n     */\n    PhysicsBody.prototype.setFriction = function (value) {\n        this.ammo.setFriction(value);\n    };\n    /** Set per body gravity */\n    PhysicsBody.prototype.setGravity = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setGravity(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setLinearFactor = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setLinearFactor(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setAngularFactor = function (x, y, z) {\n        this.tmpBtVector3.setValue(x, y, z);\n        this.ammo.setAngularFactor(this.tmpBtVector3);\n    };\n    PhysicsBody.prototype.setCcdMotionThreshold = function (threshold) {\n        this.ammo.setCcdMotionThreshold(threshold);\n    };\n    PhysicsBody.prototype.setCcdSweptSphereRadius = function (radius) {\n        this.ammo.setCcdSweptSphereRadius(radius);\n    };\n    return PhysicsBody;\n}());\nexports.default = PhysicsBody;\n//# sourceMappingURL=physicsBody.js.map","\"use strict\";\n/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar index_1 = require(\"@enable3d/three-wrapper/dist/index\");\nvar extendedMesh_1 = require(\"./extendedMesh\");\nvar logger_1 = __importDefault(require(\"./logger\"));\nvar defaultMaterial_1 = __importDefault(require(\"./defaultMaterial\"));\nvar Factories = /** @class */ (function () {\n    function Factories(scene) {\n        this.scene = scene;\n        this.isHeadless = scene === 'headless' ? true : false;\n        this.defaultMaterial = new defaultMaterial_1.default();\n    }\n    Object.defineProperty(Factories.prototype, \"make\", {\n        get: function () {\n            var _this = this;\n            return {\n                plane: function (planeConfig, materialConfig) {\n                    if (planeConfig === void 0) { planeConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makePlane(planeConfig, materialConfig);\n                },\n                box: function (boxConfig, materialConfig) {\n                    if (boxConfig === void 0) { boxConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeBox(boxConfig, materialConfig);\n                },\n                sphere: function (sphereConfig, materialConfig) {\n                    if (sphereConfig === void 0) { sphereConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeSphere(sphereConfig, materialConfig);\n                },\n                cylinder: function (cylinderConfig, materialConfig) {\n                    if (cylinderConfig === void 0) { cylinderConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeCylinder(cylinderConfig, materialConfig);\n                },\n                cone: function (coneConfig, materialConfig) {\n                    if (coneConfig === void 0) { coneConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeCone(coneConfig, materialConfig);\n                },\n                torus: function (torusConfig, materialConfig) {\n                    if (torusConfig === void 0) { torusConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeTorus(torusConfig, materialConfig);\n                },\n                extrude: function (extrudeConfig, materialConfig) {\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.makeExtrude(extrudeConfig, materialConfig);\n                }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Factories.prototype, \"add\", {\n        get: function () {\n            var _this = this;\n            return {\n                // effectComposer: () => this.addEffectComposer(),\n                mesh: function (mesh) { return _this.addMesh(mesh); },\n                // group: (...children) => this.addGroup(children),\n                existing: function (object) { return _this.addExisting(object); },\n                //  Geometry\n                plane: function (planeConfig, materialConfig) {\n                    if (planeConfig === void 0) { planeConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addPlane(planeConfig, materialConfig);\n                },\n                box: function (boxConfig, materialConfig) {\n                    if (boxConfig === void 0) { boxConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addBox(boxConfig, materialConfig);\n                },\n                ground: function (groundConfig, materialConfig) {\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addGround(groundConfig, materialConfig);\n                },\n                //...\n                sphere: function (sphereConfig, materialConfig) {\n                    if (sphereConfig === void 0) { sphereConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addSphere(sphereConfig, materialConfig);\n                },\n                cylinder: function (cylinderConfig, materialConfig) {\n                    if (cylinderConfig === void 0) { cylinderConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addCylinder(cylinderConfig, materialConfig);\n                },\n                cone: function (coneConfig, materialConfig) {\n                    if (coneConfig === void 0) { coneConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addCone(coneConfig, materialConfig);\n                },\n                torus: function (torusConfig, materialConfig) {\n                    if (torusConfig === void 0) { torusConfig = {}; }\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addTorus(torusConfig, materialConfig);\n                },\n                extrude: function (extrudeConfig, materialConfig) {\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addExtrude(extrudeConfig, materialConfig);\n                },\n                //...\n                material: function (materialConfig) {\n                    if (materialConfig === void 0) { materialConfig = {}; }\n                    return _this.addMaterial(materialConfig);\n                }\n            };\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Factories.prototype.addExisting = function () {\n        var _a;\n        var object = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            object[_i] = arguments[_i];\n        }\n        if (this.scene === 'headless')\n            return;\n        (_a = this.scene).add.apply(_a, object);\n    };\n    Factories.prototype.addMesh = function (mesh) {\n        if (Array.isArray(mesh)) {\n            for (var i = 0; i < mesh.length; i++) {\n                this.addExisting(mesh[i]);\n            }\n        }\n        else {\n            this.addExisting(mesh);\n        }\n        return this;\n    };\n    Factories.prototype.createMesh = function (geometry, material, position) {\n        var _a = position.x, x = _a === void 0 ? 0 : _a, _b = position.y, y = _b === void 0 ? 0 : _b, _c = position.z, z = _c === void 0 ? 0 : _c;\n        var obj;\n        switch (!Array.isArray(material) && material.type) {\n            case 'LineBasicMaterial':\n                obj = new index_1.Line(geometry, material);\n                break;\n            case 'PointsMaterial':\n                obj = new index_1.Points(geometry, material);\n                break;\n            default:\n                obj = new extendedMesh_1.ExtendedMesh(geometry, material);\n                break;\n        }\n        obj.position.set(x, y, z);\n        obj.castShadow = obj.receiveShadow = true;\n        return obj;\n    };\n    Factories.prototype.makeExtrude = function (extrudeConfig, materialConfig) {\n        var x = extrudeConfig.x, y = extrudeConfig.y, z = extrudeConfig.z, name = extrudeConfig.name, shape = extrudeConfig.shape, _a = extrudeConfig.autoCenter, autoCenter = _a === void 0 ? true : _a, _b = extrudeConfig.breakable, breakable = _b === void 0 ? false : _b, _c = extrudeConfig.bufferGeometry, bufferGeometry = _c === void 0 ? true : _c, rest = __rest(extrudeConfig, [\"x\", \"y\", \"z\", \"name\", \"shape\", \"autoCenter\", \"breakable\", \"bufferGeometry\"]);\n        var _d = rest.depth, depth = _d === void 0 ? 1 : _d, _e = rest.bevelEnabled, bevelEnabled = _e === void 0 ? false : _e;\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.ExtrudeBufferGeometry(shape, __assign({ depth: depth, bevelEnabled: bevelEnabled }, rest))\n            : new index_1.ExtrudeGeometry(shape, __assign({ depth: depth, bevelEnabled: bevelEnabled }, rest));\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        // auto adjust the center for custom shapes\n        if (autoCenter)\n            mesh.geometry.center();\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'extrude';\n        return mesh;\n    };\n    Factories.prototype.addExtrude = function (extrudeConfig, materialConfig) {\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeExtrude(extrudeConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makePlane = function (planeConfig, materialConfig) {\n        var x = planeConfig.x, y = planeConfig.y, z = planeConfig.z, name = planeConfig.name, _a = planeConfig.breakable, breakable = _a === void 0 ? false : _a, _b = planeConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(planeConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.PlaneBufferGeometry(rest.width || 1, rest.height || 1, rest.widthSegments || 1, rest.heightSegments || 1)\n            : new index_1.PlaneGeometry(rest.width || 1, rest.height || 1, rest.widthSegments || 1, rest.heightSegments || 1);\n        var material = this.addMaterial(materialConfig);\n        material.side = index_1.DoubleSide;\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'plane';\n        return mesh;\n    };\n    Factories.prototype.addPlane = function (planeConfig, materialConfig) {\n        var obj = this.makePlane(planeConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makeSphere = function (sphereConfig, materialConfig) {\n        var x = sphereConfig.x, y = sphereConfig.y, z = sphereConfig.z, name = sphereConfig.name, _a = sphereConfig.breakable, breakable = _a === void 0 ? false : _a, _b = sphereConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(sphereConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.SphereBufferGeometry(rest.radius || 1, rest.widthSegments || 16, rest.heightSegments || 12, rest.phiStart || undefined, rest.phiLength || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined)\n            : new index_1.SphereGeometry(rest.radius || 1, rest.widthSegments || 16, rest.heightSegments || 12, rest.phiStart || undefined, rest.phiLength || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'sphere';\n        return mesh;\n    };\n    Factories.prototype.addSphere = function (sphereConfig, materialConfig) {\n        if (sphereConfig === void 0) { sphereConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeSphere(sphereConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makeBox = function (boxConfig, materialConfig) {\n        var x = boxConfig.x, y = boxConfig.y, z = boxConfig.z, name = boxConfig.name, _a = boxConfig.breakable, breakable = _a === void 0 ? false : _a, _b = boxConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(boxConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.BoxBufferGeometry(rest.width || 1, rest.height || 1, rest.depth || 1, rest.widthSegments || undefined, rest.heightSegments || undefined, rest.depthSegments || undefined)\n            : new index_1.BoxGeometry(rest.width || 1, rest.height || 1, rest.depth || 1, rest.widthSegments || undefined, rest.heightSegments || undefined, rest.depthSegments || undefined);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'box';\n        return mesh;\n    };\n    Factories.prototype.addBox = function (boxConfig, materialConfig) {\n        if (boxConfig === void 0) { boxConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeBox(boxConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.addGround = function (groundConfig, materialConfig) {\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeBox(groundConfig, materialConfig);\n        obj.rotateX(index_1.MathUtils.degToRad(90));\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makeCylinder = function (cylinderConfig, materialConfig) {\n        if (cylinderConfig === void 0) { cylinderConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var x = cylinderConfig.x, y = cylinderConfig.y, z = cylinderConfig.z, name = cylinderConfig.name, _a = cylinderConfig.breakable, breakable = _a === void 0 ? false : _a, _b = cylinderConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(cylinderConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.CylinderBufferGeometry(rest.radiusTop || 1, rest.radiusBottom || 1, rest.height || 1, rest.radiusSegments || undefined, rest.heightSegments || undefined, rest.openEnded || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined)\n            : new index_1.CylinderGeometry(rest.radiusTop || 1, rest.radiusBottom || 1, rest.height || 1, rest.radiusSegments || undefined, rest.heightSegments || undefined, rest.openEnded || undefined, rest.thetaStart || undefined, rest.thetaLength || undefined);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'cylinder';\n        return mesh;\n    };\n    Factories.prototype.addCylinder = function (cylinderConfig, materialConfig) {\n        if (cylinderConfig === void 0) { cylinderConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeCylinder(cylinderConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.makeCone = function (coneConfig, materialConfig) {\n        if (coneConfig === void 0) { coneConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var x = coneConfig.x, y = coneConfig.y, z = coneConfig.z, name = coneConfig.name, _a = coneConfig.breakable, breakable = _a === void 0 ? false : _a, _b = coneConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(coneConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.ConeBufferGeometry(rest.radius || 1, rest.height || 1, rest.radiusSegments || 8, rest.heightSegments || 1, rest.openEnded || false, rest.thetaStart || 0, rest.thetaLength || 2 * Math.PI)\n            : new index_1.ConeBufferGeometry(rest.radius || 1, rest.height || 1, rest.radiusSegments || 8, rest.heightSegments || 1, rest.openEnded || false, rest.thetaStart || 0, rest.thetaLength || 2 * Math.PI);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'cone';\n        return mesh;\n    };\n    Factories.prototype.addCone = function (coneConfig, materialConfig) {\n        if (coneConfig === void 0) { coneConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeCone(coneConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    // https://threejs.org/docs/index.html#api/en/geometries/TorusBufferGeometry\n    Factories.prototype.makeTorus = function (torusConfig, materialConfig) {\n        if (torusConfig === void 0) { torusConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var x = torusConfig.x, y = torusConfig.y, z = torusConfig.z, name = torusConfig.name, _a = torusConfig.breakable, breakable = _a === void 0 ? false : _a, _b = torusConfig.bufferGeometry, bufferGeometry = _b === void 0 ? true : _b, rest = __rest(torusConfig, [\"x\", \"y\", \"z\", \"name\", \"breakable\", \"bufferGeometry\"]);\n        var geometry = bufferGeometry || breakable || this.isHeadless\n            ? new index_1.TorusBufferGeometry(rest.radius || undefined, rest.tube || undefined, rest.radialSegments || undefined, rest.tubularSegments || undefined, rest.arc || undefined)\n            : new index_1.TorusGeometry(rest.radius || undefined, rest.tube || undefined, rest.radialSegments || undefined, rest.tubularSegments || undefined, rest.arc || undefined);\n        var material = this.addMaterial(materialConfig);\n        var mesh = this.createMesh(geometry, material, { x: x, y: y, z: z });\n        mesh.name = name || \"body_id_\" + mesh.id;\n        mesh.shape = 'torus';\n        return mesh;\n    };\n    Factories.prototype.addTorus = function (torusConfig, materialConfig) {\n        if (torusConfig === void 0) { torusConfig = {}; }\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var obj = this.makeTorus(torusConfig, materialConfig);\n        this.addExisting(obj);\n        return obj;\n    };\n    Factories.prototype.addMaterial = function (materialConfig) {\n        if (materialConfig === void 0) { materialConfig = {}; }\n        var type = Object.keys(materialConfig)[0];\n        var material;\n        // if (type) {\n        //   const { map } = materialConfig[type]\n        //   if (typeof map === 'string') materialConfig[type].map = this.loadTexture(map)\n        // }\n        // always share the same material in headless mode to save memory\n        if (this.scene === 'headless')\n            return this.defaultMaterial.get();\n        switch (type) {\n            case 'basic':\n                material = new index_1.MeshBasicMaterial(materialConfig.basic);\n                break;\n            case 'normal':\n                material = new index_1.MeshNormalMaterial(materialConfig.normal);\n                break;\n            case 'standard':\n                material = new index_1.MeshStandardMaterial(materialConfig.standard);\n                break;\n            case 'lambert':\n                material = new index_1.MeshLambertMaterial(materialConfig.lambert);\n                break;\n            case 'phong':\n                material = new index_1.MeshPhongMaterial(materialConfig.phong);\n                break;\n            case 'physical':\n                if (typeof materialConfig.physical !== 'undefined') {\n                    material = new index_1.MeshPhysicalMaterial(materialConfig.physical);\n                }\n                else {\n                    logger_1.default('You need to pass parameters to the physical material. (Fallback to default material)');\n                    material = this.defaultMaterial.get();\n                }\n                break;\n            case 'toon':\n                material = new index_1.MeshToonMaterial(materialConfig.toon);\n                break;\n            case 'line':\n                material = new index_1.LineBasicMaterial(materialConfig.line);\n                break;\n            case 'points':\n                material = new index_1.PointsMaterial(materialConfig.points);\n                break;\n            case 'custom':\n                material = materialConfig.custom || this.defaultMaterial.get();\n                break;\n            default:\n                material = this.defaultMaterial.get();\n                break;\n        }\n        return material;\n    };\n    return Factories;\n}());\nexports.default = Factories;\n//# sourceMappingURL=factories.js.map","'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// Inspired by https://github.com/playcanvas/engine/blob/master/examples/wasm-loader.js\nvar wasmSupported = (function () {\n    try {\n        if (typeof WebAssembly === 'object' && typeof WebAssembly.instantiate === 'function') {\n            var module_1 = new WebAssembly.Module(Uint8Array.of(0x0, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00));\n            if (module_1 instanceof WebAssembly.Module)\n                return new WebAssembly.Instance(module_1) instanceof WebAssembly.Instance;\n        }\n    }\n    catch (e) { }\n    return false;\n})();\nvar loadScriptAsync = function (url, doneCallback) {\n    var tag = document.createElement('script');\n    tag.onload = function () {\n        doneCallback();\n    };\n    tag.onerror = function () {\n        throw new Error('failed to load ' + url);\n    };\n    tag.async = true;\n    tag.src = url;\n    document.head.appendChild(tag);\n};\nvar loadAmmoModule = function (path, doneCallback) {\n    // console.log(wasmSupported ? 'WebAssembly is supported' : 'WebAssembly is not supported')\n    if (wasmSupported)\n        loadScriptAsync(path + \"/ammo.wasm.js\", function () { return doneCallback(); });\n    else\n        loadScriptAsync(path + \"/ammo.js\", function () { return doneCallback(); });\n};\nexports.default = loadAmmoModule;\n//# sourceMappingURL=wasmLoader.js.map","/**\n * Copied from three.js examples and added a fix\n */\n\n/**\n * @author yomboprime https://github.com/yomboprime\n *\n * @fileoverview This class can be used to subdivide a convex Geometry object into pieces.\n *\n * Usage:\n *\n * Use the function prepareBreakableObject to prepare a Mesh object to be broken.\n *\n * Then, call the various functions to subdivide the object (subdivideByImpact, cutByPlane)\n *\n * Sub-objects that are product of subdivision don't need prepareBreakableObject to be called on them.\n *\n * Requisites for the object:\n *\n *  - Mesh object must have a BufferGeometry (not Geometry) and a Material\n *\n *  - Vertex normals must be planar (not smoothed)\n *\n *  - The geometry must be convex (this is not checked in the library). You can create convex\n *  geometries with ConvexBufferGeometry. The BoxBufferGeometry, SphereBufferGeometry and other convex primitives\n *  can also be used.\n *\n * Note: This lib adds member variables to object's userData member (see prepareBreakableObject function)\n * Use with caution and read the code when using with other libs.\n *\n * @param {double} minSizeForBreak Min size a debris can have to break.\n * @param {double} smallDelta Max distance to consider that a point belongs to a plane.\n *\n */\n\nimport { Line3, Mesh, Plane, Vector3 } from '@enable3d/three-wrapper/dist/index'\nimport { ConvexBufferGeometry } from '@enable3d/three-wrapper/dist/index'\nimport logger from '@enable3d/common/dist/logger'\n\nconst ConvexObjectBreaker = function (minSizeForBreak?: number, smallDelta?: number) {\n  // @ts-ignore\n  this.minSizeForBreak = minSizeForBreak || 1.4\n  // @ts-ignore\n  this.smallDelta = smallDelta || 0.0001\n\n  // @ts-ignore\n  this.tempLine1 = new Line3()\n  // @ts-ignore\n  this.tempPlane1 = new Plane()\n  // @ts-ignore\n  this.tempPlane2 = new Plane()\n  // @ts-ignore\n  this.tempPlane_Cut = new Plane()\n  // @ts-ignore\n  this.tempCM1 = new Vector3()\n  // @ts-ignore\n  this.tempCM2 = new Vector3()\n  // @ts-ignore\n  this.tempVector3 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_2 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_3 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_P0 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_P1 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_P2 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_N0 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_N1 = new Vector3()\n  // @ts-ignore\n  this.tempVector3_AB = new Vector3()\n  // @ts-ignore\n  this.tempVector3_CB = new Vector3()\n  // @ts-ignore\n  this.tempResultObjects = { object1: null, object2: null }\n\n  // @ts-ignore\n  this.segments = []\n  var n = 30 * 30\n  // @ts-ignore\n  for (var i = 0; i < n; i++) this.segments[i] = false\n}\n\nConvexObjectBreaker.prototype = {\n  constructor: ConvexObjectBreaker,\n\n  prepareBreakableObject: function (object: any, mass: any, velocity: any, angularVelocity: any, breakable: any) {\n    // object is a Object3d (normally a Mesh), must have a BufferGeometry, and it must be convex.\n    // Its material property is propagated to its children (sub-pieces)\n    // mass must be > 0\n\n    if (!object.geometry.isBufferGeometry) {\n      console.error('THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.')\n    }\n\n    var userData = object.userData\n    userData.mass = mass\n    userData.velocity = velocity.clone()\n    userData.angularVelocity = angularVelocity.clone()\n    userData.breakable = breakable\n  },\n\n  /*\n   * @param {int} maxRadialIterations Iterations for radial cuts.\n   * @param {int} maxRandomIterations Max random iterations for not-radial cuts\n   *\n   * Returns the array of pieces\n   */\n  subdivideByImpact: function (\n    object: any,\n    pointOfImpact: any,\n    normal: any,\n    maxRadialIterations: any,\n    maxRandomIterations: any\n  ) {\n    var debris: any = []\n\n    var tempPlane1 = this.tempPlane1\n    var tempPlane2 = this.tempPlane2\n\n    this.tempVector3.addVectors(pointOfImpact, normal)\n    tempPlane1.setFromCoplanarPoints(pointOfImpact, object.position, this.tempVector3)\n\n    var maxTotalIterations = maxRandomIterations + maxRadialIterations\n\n    var scope = this\n\n    function subdivideRadial(subObject: any, startAngle: any, endAngle: any, numIterations: any) {\n      if (Math.random() < numIterations * 0.05 || numIterations > maxTotalIterations) {\n        debris.push(subObject)\n\n        return\n      }\n\n      var angle = Math.PI\n\n      if (numIterations === 0) {\n        tempPlane2.normal.copy(tempPlane1.normal)\n        tempPlane2.constant = tempPlane1.constant\n      } else {\n        if (numIterations <= maxRadialIterations) {\n          angle = (endAngle - startAngle) * (0.2 + 0.6 * Math.random()) + startAngle\n\n          // Rotate tempPlane2 at impact point around normal axis and the angle\n          scope.tempVector3_2.copy(object.position).sub(pointOfImpact).applyAxisAngle(normal, angle).add(pointOfImpact)\n          tempPlane2.setFromCoplanarPoints(pointOfImpact, scope.tempVector3, scope.tempVector3_2)\n        } else {\n          angle = (0.5 * (numIterations & 1) + 0.2 * (2 - Math.random())) * Math.PI\n\n          // Rotate tempPlane2 at object position around normal axis and the angle\n          scope.tempVector3_2\n            .copy(pointOfImpact)\n            .sub(subObject.position)\n            .applyAxisAngle(normal, angle)\n            .add(subObject.position)\n          scope.tempVector3_3.copy(normal).add(subObject.position)\n          tempPlane2.setFromCoplanarPoints(subObject.position, scope.tempVector3_3, scope.tempVector3_2)\n        }\n      }\n\n      // Perform the cut\n      scope.cutByPlane(subObject, tempPlane2, scope.tempResultObjects)\n\n      var obj1 = scope.tempResultObjects.object1\n      var obj2 = scope.tempResultObjects.object2\n\n      if (obj1) {\n        subdivideRadial(obj1, startAngle, angle, numIterations + 1)\n      }\n\n      if (obj2) {\n        subdivideRadial(obj2, angle, endAngle, numIterations + 1)\n      }\n    }\n\n    subdivideRadial(object, 0, 2 * Math.PI, 0)\n\n    return debris\n  },\n\n  cutByPlane: function (object: any, plane: any, output: any) {\n    // Returns breakable objects in output.object1 and output.object2 members, the resulting 2 pieces of the cut.\n    // object2 can be null if the plane doesn't cut the object.\n    // object1 can be null only in case of internal error\n    // Returned value is number of pieces, 0 for error.\n\n    var geometry = object.geometry\n    var coords = geometry.attributes.position.array\n    var normals = geometry.attributes.normal.array\n\n    var numPoints = coords.length / 3\n    var numFaces = numPoints / 3\n\n    var indices = geometry.getIndex()\n\n    if (indices) {\n      indices = indices.array\n      numFaces = indices.length / 3\n    }\n\n    function getVertexIndex(faceIdx: any, vert: any) {\n      // vert = 0, 1 or 2.\n\n      var idx = faceIdx * 3 + vert\n\n      return indices ? indices[idx] : idx\n    }\n\n    var points1 = []\n    var points2 = []\n\n    var delta = this.smallDelta\n\n    // Reset segments mark\n    var numPointPairs = numPoints * numPoints\n    for (var i = 0; i < numPointPairs; i++) this.segments[i] = false\n\n    var p0 = this.tempVector3_P0\n    var p1 = this.tempVector3_P1\n    var n0 = this.tempVector3_N0\n    var n1 = this.tempVector3_N1\n\n    // Iterate through the faces to mark edges shared by coplanar faces\n    for (var i = 0; i < numFaces - 1; i++) {\n      var a1 = getVertexIndex(i, 0)\n      var b1 = getVertexIndex(i, 1)\n      var c1 = getVertexIndex(i, 2)\n\n      // Assuming all 3 vertices have the same normal\n      n0.set(normals[a1], normals[a1] + 1, normals[a1] + 2)\n\n      for (var j = i + 1; j < numFaces; j++) {\n        var a2 = getVertexIndex(j, 0)\n        var b2 = getVertexIndex(j, 1)\n        var c2 = getVertexIndex(j, 2)\n\n        // Assuming all 3 vertices have the same normal\n        n1.set(normals[a2], normals[a2] + 1, normals[a2] + 2)\n\n        var coplanar = 1 - n0.dot(n1) < delta\n\n        if (coplanar) {\n          if (a1 === a2 || a1 === b2 || a1 === c2) {\n            if (b1 === a2 || b1 === b2 || b1 === c2) {\n              this.segments[a1 * numPoints + b1] = true\n              this.segments[b1 * numPoints + a1] = true\n            } else {\n              this.segments[c1 * numPoints + a1] = true\n              this.segments[a1 * numPoints + c1] = true\n            }\n          } else if (b1 === a2 || b1 === b2 || b1 === c2) {\n            this.segments[c1 * numPoints + b1] = true\n            this.segments[b1 * numPoints + c1] = true\n          }\n        }\n      }\n    }\n\n    // Transform the plane to object local space\n    var localPlane = this.tempPlane_Cut\n    object.updateMatrix()\n    ConvexObjectBreaker.transformPlaneToLocalSpace(plane, object.matrix, localPlane)\n\n    // Iterate through the faces adding points to both pieces\n    for (var i = 0; i < numFaces; i++) {\n      var va = getVertexIndex(i, 0)\n      var vb = getVertexIndex(i, 1)\n      var vc = getVertexIndex(i, 2)\n\n      for (var segment = 0; segment < 3; segment++) {\n        var i0 = segment === 0 ? va : segment === 1 ? vb : vc\n        var i1 = segment === 0 ? vb : segment === 1 ? vc : va\n\n        var segmentState = this.segments[i0 * numPoints + i1]\n\n        if (segmentState) continue // The segment already has been processed in another face\n\n        // Mark segment as processed (also inverted segment)\n        this.segments[i0 * numPoints + i1] = true\n        this.segments[i1 * numPoints + i0] = true\n\n        p0.set(coords[3 * i0], coords[3 * i0 + 1], coords[3 * i0 + 2])\n        p1.set(coords[3 * i1], coords[3 * i1 + 1], coords[3 * i1 + 2])\n\n        // mark: 1 for negative side, 2 for positive side, 3 for coplanar point\n        var mark0 = 0\n\n        var d = localPlane.distanceToPoint(p0)\n\n        if (d > delta) {\n          mark0 = 2\n          points2.push(p0.clone())\n        } else if (d < -delta) {\n          mark0 = 1\n          points1.push(p0.clone())\n        } else {\n          mark0 = 3\n          points1.push(p0.clone())\n          points2.push(p0.clone())\n        }\n\n        // mark: 1 for negative side, 2 for positive side, 3 for coplanar point\n        var mark1 = 0\n\n        var d = localPlane.distanceToPoint(p1)\n\n        if (d > delta) {\n          mark1 = 2\n          points2.push(p1.clone())\n        } else if (d < -delta) {\n          mark1 = 1\n          points1.push(p1.clone())\n        } else {\n          mark1 = 3\n          points1.push(p1.clone())\n          points2.push(p1.clone())\n        }\n\n        if ((mark0 === 1 && mark1 === 2) || (mark0 === 2 && mark1 === 1)) {\n          // Intersection of segment with the plane\n\n          this.tempLine1.start.copy(p0)\n          this.tempLine1.end.copy(p1)\n\n          var intersection = new Vector3()\n          intersection = localPlane.intersectLine(this.tempLine1, intersection)\n\n          if (intersection === undefined) {\n            // Shouldn't happen\n            console.error('Internal error: segment does not intersect plane.')\n            output.segmentedObject1 = null\n            output.segmentedObject2 = null\n            return 0\n          }\n\n          points1.push(intersection)\n          points2.push(intersection.clone())\n        }\n      }\n    }\n\n    // Calculate debris mass (very fast and imprecise):\n    var newMass = object.userData.mass * 0.5\n\n    // Calculate debris Center of Mass (again fast and imprecise)\n    this.tempCM1.set(0, 0, 0)\n    var radius1 = 0\n    var numPoints1 = points1.length\n\n    if (numPoints1 > 0) {\n      for (var i = 0; i < numPoints1; i++) this.tempCM1.add(points1[i])\n\n      this.tempCM1.divideScalar(numPoints1)\n      for (var i = 0; i < numPoints1; i++) {\n        var p = points1[i]\n        p.sub(this.tempCM1)\n        radius1 = Math.max(radius1, p.x, p.y, p.z)\n      }\n      this.tempCM1.add(object.position)\n    }\n\n    this.tempCM2.set(0, 0, 0)\n    var radius2 = 0\n    var numPoints2 = points2.length\n    if (numPoints2 > 0) {\n      for (var i = 0; i < numPoints2; i++) this.tempCM2.add(points2[i])\n\n      this.tempCM2.divideScalar(numPoints2)\n      for (var i = 0; i < numPoints2; i++) {\n        var p = points2[i]\n        p.sub(this.tempCM2)\n        radius2 = Math.max(radius2, p.x, p.y, p.z)\n      }\n      this.tempCM2.add(object.position)\n    }\n\n    var object1 = null\n    var object2 = null\n\n    var numObjects = 0\n\n    /**\n     * MOD: Wrapped in try catch block to avoid errors\n     */\n    if (numPoints1 > 4) {\n      try {\n        object1 = new Mesh(new ConvexBufferGeometry(points1), object.material)\n        object1.position.copy(this.tempCM1)\n        object1.quaternion.copy(object.quaternion)\n\n        this.prepareBreakableObject(\n          object1,\n          newMass,\n          object.userData.velocity,\n          object.userData.angularVelocity,\n          2 * radius1 > this.minSizeForBreak\n        )\n\n        numObjects++\n      } catch (error) {\n        logger('Error in ConvexObjectBreaker.ts')\n      }\n    }\n\n    if (numPoints2 > 4) {\n      try {\n        object2 = new Mesh(new ConvexBufferGeometry(points2), object.material)\n        object2.position.copy(this.tempCM2)\n        object2.quaternion.copy(object.quaternion)\n\n        this.prepareBreakableObject(\n          object2,\n          newMass,\n          object.userData.velocity,\n          object.userData.angularVelocity,\n          2 * radius2 > this.minSizeForBreak\n        )\n\n        numObjects++\n      } catch (error) {\n        logger('Error in ConvexObjectBreaker.ts')\n      }\n    }\n\n    output.object1 = object1\n    output.object2 = object2\n\n    return numObjects\n  }\n}\n\nConvexObjectBreaker.transformFreeVector = function (v: any, m: any) {\n  // input:\n  // vector interpreted as a free vector\n  // THREE.Matrix4 orthogonal matrix (matrix without scale)\n\n  var x = v.x,\n    y = v.y,\n    z = v.z\n  var e = m.elements\n\n  v.x = e[0] * x + e[4] * y + e[8] * z\n  v.y = e[1] * x + e[5] * y + e[9] * z\n  v.z = e[2] * x + e[6] * y + e[10] * z\n\n  return v\n}\n\nConvexObjectBreaker.transformFreeVectorInverse = function (v: any, m: any) {\n  // input:\n  // vector interpreted as a free vector\n  // THREE.Matrix4 orthogonal matrix (matrix without scale)\n\n  var x = v.x,\n    y = v.y,\n    z = v.z\n  var e = m.elements\n\n  v.x = e[0] * x + e[1] * y + e[2] * z\n  v.y = e[4] * x + e[5] * y + e[6] * z\n  v.z = e[8] * x + e[9] * y + e[10] * z\n\n  return v\n}\n\nConvexObjectBreaker.transformTiedVectorInverse = function (v: any, m: any) {\n  // input:\n  // vector interpreted as a tied (ordinary) vector\n  // THREE.Matrix4 orthogonal matrix (matrix without scale)\n\n  var x = v.x,\n    y = v.y,\n    z = v.z\n  var e = m.elements\n\n  v.x = e[0] * x + e[1] * y + e[2] * z - e[12]\n  v.y = e[4] * x + e[5] * y + e[6] * z - e[13]\n  v.z = e[8] * x + e[9] * y + e[10] * z - e[14]\n\n  return v\n}\n\nConvexObjectBreaker.transformPlaneToLocalSpace = (function () {\n  var v1 = new Vector3()\n\n  return function transformPlaneToLocalSpace(plane: any, m: any, resultPlane: any) {\n    resultPlane.normal.copy(plane.normal)\n    resultPlane.constant = plane.constant\n\n    var referencePoint = ConvexObjectBreaker.transformTiedVectorInverse(plane.coplanarPoint(v1), m)\n\n    ConvexObjectBreaker.transformFreeVectorInverse(resultPlane.normal, m)\n\n    // recalculate constant (like in setFromNormalAndCoplanarPoint)\n    resultPlane.constant = -referencePoint.dot(resultPlane.normal)\n  }\n})()\n\nexport { ConvexObjectBreaker }\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport {\n  SphereConfig,\n  MaterialConfig,\n  BoxConfig,\n  GroundConfig,\n  CylinderConfig,\n  ExtendedObject3D,\n  ExtrudeConfig,\n  TorusConfig,\n  AddExistingConfig,\n  PlaneConfig,\n  ConeConfig\n} from '@enable3d/common/dist/types'\nimport Factories from '@enable3d/common/dist/factories'\n\ninterface Shapes {}\n\nclass Shapes {\n  public tmpTrans: Ammo.btTransform\n  public physicsWorld: Ammo.btDiscreteDynamicsWorld\n  public objectsAmmo: { [ptr: number]: ExtendedObject3D } = {}\n  protected addExisting: (object: ExtendedObject3D, config?: AddExistingConfig) => void\n  protected factory: Factories\n\n  protected addPlane(planeConfig: PlaneConfig = {}, materialConfig: MaterialConfig = {}) {\n    const plane = this.factory.add.plane(planeConfig, materialConfig)\n    this.addExisting(plane, planeConfig)\n    return plane\n  }\n\n  protected addSphere(sphereConfig: SphereConfig = {}, materialConfig: MaterialConfig = {}) {\n    const sphere = this.factory.add.sphere(sphereConfig, materialConfig)\n    this.addExisting(sphere, sphereConfig)\n    return sphere\n  }\n\n  protected addBox(boxConfig: BoxConfig = {}, materialConfig: MaterialConfig = {}) {\n    const box = this.factory.add.box(boxConfig, materialConfig)\n    this.addExisting(box, boxConfig)\n    return box\n  }\n\n  protected addGround(groundConfig: GroundConfig, materialConfig: MaterialConfig = {}) {\n    const ground = this.factory.add.ground(groundConfig, materialConfig)\n    const config = { ...groundConfig, mass: 0, collisionFlags: 1 }\n    this.addExisting(ground, config)\n    return ground\n  }\n\n  protected addCylinder(cylinderConfig: CylinderConfig = {}, materialConfig: MaterialConfig = {}) {\n    const cylinder = this.factory.add.cylinder(cylinderConfig, materialConfig)\n    this.addExisting(cylinder, cylinderConfig)\n    return cylinder\n  }\n\n  protected addCone(coneConfig: ConeConfig = {}, materialConfig: MaterialConfig = {}) {\n    const cone = this.factory.add.cone(coneConfig, materialConfig)\n    this.addExisting(cone, coneConfig)\n    return cone\n  }\n\n  protected addTorus(torusConfig: TorusConfig = {}, materialConfig: MaterialConfig = {}) {\n    const torus = this.factory.add.torus(torusConfig, materialConfig)\n    this.addExisting(torus, torusConfig)\n    return torus\n  }\n\n  protected addExtrude(extrudeConfig: ExtrudeConfig, materialConfig: MaterialConfig = {}) {\n    const object = this.factory.add.extrude(extrudeConfig, materialConfig)\n    object.translateX(1)\n    this.addExisting(object)\n    return object\n  }\n}\n\nexport default Shapes\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\n// Inspired by https://github.com/donmccurdy/aframe-physics-system/blob/master/src/components/ammo-constraint.js\n\nimport PhysicsBody from '@enable3d/common/dist/physicsBody'\nimport { XYZ } from '@enable3d/common/dist/types'\nimport Physics from './physics'\n\nexport default class Constraints {\n  public tmpTrans: Ammo.btTransform\n  public physicsWorld: Ammo.btDiscreteDynamicsWorld\n\n  protected tmpBtVector3: Ammo.btVector3\n\n  constructor() {}\n\n  private toAmmoV3(v?: XYZ, d: number = 0) {\n    return new Ammo.btVector3(\n      typeof v?.x !== 'undefined' ? v.x : d,\n      typeof v?.y !== 'undefined' ? v.y : d,\n      typeof v?.z !== 'undefined' ? v.z : d\n    )\n  }\n\n  protected get addConstraints() {\n    return {\n      lock: (body: PhysicsBody, targetBody: PhysicsBody) => this.lock(body, targetBody),\n      fixed: (body: PhysicsBody, targetBody: PhysicsBody) => this.fixed(body, targetBody),\n      pointToPoint: (\n        body: PhysicsBody,\n        targetBody: PhysicsBody,\n        config: {\n          pivotA?: XYZ\n          pivotB?: XYZ\n        }\n      ) => this.pointToPoint(body, targetBody, config),\n      hinge: (\n        body: PhysicsBody,\n        targetBody: PhysicsBody,\n        config: {\n          pivotA?: XYZ\n          pivotB?: XYZ\n          axisA?: XYZ\n          axisB?: XYZ\n        }\n      ) => this.hinge(body, targetBody, config),\n      slider: (\n        body: PhysicsBody,\n        targetBody: PhysicsBody,\n        config: {\n          frameA?: XYZ\n          frameB?: XYZ\n          linearLowerLimit?: number\n          linearUpperLimit?: number\n          angularLowerLimit?: number\n          angularUpperLimit?: number\n        } = {}\n      ) => this.slider(body, targetBody, config),\n      spring: (\n        body: PhysicsBody,\n        targetBody: PhysicsBody,\n        config: {\n          stiffness?: number\n          damping?: number\n          angularLock?: boolean\n          linearLowerLimit?: XYZ\n          linearUpperLimit?: XYZ\n        } = {}\n      ) => this.spring(body, targetBody, config),\n      coneTwist: (bodyA: PhysicsBody, bodyB: PhysicsBody, frameA: XYZ = {}, frameB: XYZ = {}) =>\n        this.coneTwist(bodyA, bodyB, frameA, frameB),\n      dof: (\n        bodyA: PhysicsBody,\n        bodyB: PhysicsBody,\n        config?: {\n          linearLowerLimit?: XYZ\n          linearUpperLimit?: XYZ\n          angularLowerLimit?: XYZ\n          angularUpperLimit?: XYZ\n          center?: boolean\n          offset?: XYZ\n        }\n      ) => this.dof(bodyA, bodyB, config)\n    }\n  }\n\n  private getTransform(\n    bodyA: Ammo.btRigidBody,\n    bodyB: Ammo.btRigidBody,\n    offset: { x: number; y: number; z: number } = { x: 0, y: 0, z: 0 },\n    center: boolean = false\n  ) {\n    offset = { x: 0, y: 0, z: 0, ...offset }\n\n    const centerVector = (v1: Ammo.btVector3, v2: Ammo.btVector3) => {\n      var dx = (v1.x() - v2.x()) / 2 + offset.x\n      var dy = (v1.y() - v2.y()) / 2 + offset.y\n      var dz = (v1.z() - v2.z()) / 2 + offset.z\n      return new Ammo.btVector3(dx, dy, dz)\n    }\n\n    const transformB = new Ammo.btTransform()\n    transformB.setIdentity()\n\n    if (!center) {\n      // offset\n      transformB.setOrigin(new Ammo.btVector3(offset.x, offset.y, offset.z))\n\n      const transformA = bodyA\n        .getCenterOfMassTransform()\n        .inverse()\n        .op_mul(bodyB.getWorldTransform())\n        .op_mul(transformB)\n\n      return { transformA: transformA, transformB: transformB }\n    } else {\n      const center = centerVector(bodyA.getWorldTransform().getOrigin(), bodyB.getWorldTransform().getOrigin())\n\n      const transformB = new Ammo.btTransform()\n      transformB.setIdentity()\n      transformB.setOrigin(center)\n\n      const transformA = bodyA\n        .getCenterOfMassTransform()\n        .inverse()\n        .op_mul(bodyB.getWorldTransform())\n\n      transformA.op_mul(transformB)\n\n      return { transformA: transformA, transformB: transformB }\n    }\n  }\n\n  private lock(bodyA: PhysicsBody, bodyB: PhysicsBody) {\n    const zero = { x: 0, y: 0, z: 0 }\n    return this.dof(bodyA, bodyB, { angularLowerLimit: zero, angularUpperLimit: zero })\n  }\n\n  private fixed(bodyA: PhysicsBody, bodyB: PhysicsBody) {\n    const transform = this.getTransform(bodyA.ammo, bodyB.ammo)\n    transform.transformA.setRotation(bodyA.ammo.getWorldTransform().getRotation())\n    transform.transformB.setRotation(bodyB.ammo.getWorldTransform().getRotation())\n    const constraint = new Ammo.btFixedConstraint(bodyA.ammo, bodyB.ammo, transform.transformA, transform.transformB)\n    this.physicsWorld.addConstraint(constraint)\n    return constraint\n  }\n\n  private pointToPoint(\n    body: PhysicsBody,\n    targetBody: PhysicsBody,\n    config: {\n      pivotA?: XYZ\n      pivotB?: XYZ\n    } = {}\n  ) {\n    const { pivotA, pivotB } = config\n    const pivotV3 = new Ammo.btVector3(pivotA?.x || 0, pivotA?.y || 0, pivotA?.z || 0)\n    const targetPivotV3 = new Ammo.btVector3(pivotB?.x || 0, pivotB?.y || 0, pivotB?.z || 0)\n    const constraint = new Ammo.btPoint2PointConstraint(body.ammo, targetBody.ammo, pivotV3, targetPivotV3)\n    this.physicsWorld.addConstraint(constraint)\n    return constraint\n  }\n\n  private hinge(\n    body: PhysicsBody,\n    targetBody: PhysicsBody,\n    config: {\n      pivotA?: XYZ\n      pivotB?: XYZ\n      axisA?: XYZ\n      axisB?: XYZ\n    } = {}\n  ) {\n    const { pivotA, pivotB, axisA, axisB } = config\n    const pivotV3 = new Ammo.btVector3(pivotA?.x || 0, pivotA?.y || 0, pivotA?.z || 0)\n    const targetPivotV3 = new Ammo.btVector3(pivotB?.x || 0, pivotB?.y || 0, pivotB?.z || 0)\n    const axisV3 = new Ammo.btVector3(axisA?.x || 0, axisA?.y || 0, axisA?.z || 0)\n    const targetAxisV3 = new Ammo.btVector3(axisB?.x || 0, axisB?.y || 0, axisB?.z || 0)\n    const constraint = new Ammo.btHingeConstraint(\n      body.ammo,\n      targetBody.ammo,\n      pivotV3,\n      targetPivotV3,\n      axisV3,\n      targetAxisV3,\n      true\n    )\n    this.physicsWorld.addConstraint(constraint)\n    return constraint\n  }\n\n  // https://pybullet.org/Bullet/phpBB3/viewtopic.php?f=9&t=12690&p=42152&hilit=btSliderConstraint#p42152\n  private slider(\n    bodyA: PhysicsBody,\n    bodyB: PhysicsBody,\n    config: {\n      frameA?: XYZ\n      frameB?: XYZ\n      linearLowerLimit?: number\n      linearUpperLimit?: number\n      angularLowerLimit?: number\n      angularUpperLimit?: number\n    } = {}\n  ) {\n    const transform = this.getTransform(bodyA.ammo, bodyB.ammo)\n\n    const {\n      frameA = {},\n      frameB = {},\n      linearLowerLimit: lll = 0,\n      linearUpperLimit: lul = 0,\n      angularLowerLimit: all = 0,\n      angularUpperLimit: aul = 0\n    } = config\n\n    const rotationA = transform.transformA.getRotation()\n    rotationA.setEulerZYX(frameA.x || 0, frameA.y || 0, frameA.z || 0)\n    transform.transformA.setRotation(rotationA)\n\n    const rotationB = transform.transformB.getRotation()\n    rotationB.setEulerZYX(frameB.x || 0, frameB.y || 0, frameB.z || 0)\n    transform.transformB.setRotation(rotationB)\n\n    const constraint = new Ammo.btSliderConstraint(\n      bodyA.ammo,\n      bodyB.ammo,\n      transform.transformA,\n      transform.transformB,\n      true\n    )\n\n    constraint.setLowerLinLimit(lll)\n    constraint.setUpperLinLimit(lul)\n    constraint.setLowerAngLimit(all)\n    constraint.setUpperAngLimit(aul)\n\n    this.physicsWorld.addConstraint(constraint)\n    return constraint\n  }\n\n  private spring(\n    body: PhysicsBody,\n    targetBody: PhysicsBody,\n    config: {\n      stiffness?: number\n      damping?: number\n      angularLock?: boolean\n      linearLowerLimit?: XYZ\n      linearUpperLimit?: XYZ\n    } = {}\n  ) {\n    const {\n      stiffness = 50,\n      damping = 0.01,\n      angularLock = false,\n      linearLowerLimit: lll = {},\n      linearUpperLimit: lul = {}\n    } = config\n\n    const transform = this.getTransform(body.ammo, targetBody.ammo)\n    const constraint = new Ammo.btGeneric6DofSpringConstraint(\n      body.ammo,\n      targetBody.ammo,\n      transform.transformA,\n      transform.transformB,\n      true\n    )\n\n    this.tmpBtVector3.setValue(lll.x || 0, lll.y || 0, lll.z || 0)\n    constraint.setLinearLowerLimit(this.tmpBtVector3)\n\n    this.tmpBtVector3.setValue(lul.x || 0, lul.y || 0, lul.z || 0)\n    constraint.setLinearUpperLimit(this.tmpBtVector3)\n\n    if (angularLock) {\n      this.tmpBtVector3.setValue(0, 0, 0)\n      constraint.setAngularLowerLimit(this.tmpBtVector3)\n      constraint.setAngularUpperLimit(this.tmpBtVector3)\n    }\n\n    for (let i = 0; i < 3; i++) {\n      constraint.enableSpring(i, true)\n      constraint.setStiffness(i, stiffness)\n      constraint.setDamping(i, damping)\n    }\n\n    // I have no idea what setEquilibriumPoint does :/\n    // constraint.setEquilibriumPoint()\n\n    this.physicsWorld.addConstraint(constraint)\n\n    return constraint\n  }\n\n  private coneTwist(bodyA: PhysicsBody, bodyB: PhysicsBody, frameA: XYZ = {}, frameB: XYZ = {}) {\n    const rbAFrame = new Ammo.btTransform()\n    rbAFrame.setIdentity()\n    rbAFrame.getOrigin().setValue(frameA?.x || 0, frameA?.y || 0, frameA?.z || 0)\n\n    const rbBFrame = new Ammo.btTransform()\n    rbBFrame.setIdentity()\n    rbBFrame.getOrigin().setValue(frameB?.x || 0, frameB?.y || 0, frameB?.z || 0)\n\n    const t = this.getTransform(bodyA.ammo, bodyB.ammo)\n\n    const constraint = new Ammo.btConeTwistConstraint(bodyB.ammo, bodyA.ammo, rbAFrame, rbBFrame)\n\n    // does not work at all :/\n    // constraint.setLimit(-Math.PI / 50, Math.PI / 50)\n\n    constraint.setAngularOnly(true)\n\n    this.physicsWorld.addConstraint(constraint)\n\n    return constraint\n  }\n\n  private dof(\n    bodyA: PhysicsBody,\n    bodyB: PhysicsBody,\n    config: {\n      linearLowerLimit?: XYZ\n      linearUpperLimit?: XYZ\n      angularLowerLimit?: XYZ\n      angularUpperLimit?: XYZ\n      center?: boolean\n      offset?: XYZ\n    } = {}\n  ) {\n    const { offset, center = false } = config\n    const off = { x: 0, y: 0, z: 0, ...offset }\n\n    const transform = this.getTransform(bodyA.ammo, bodyB.ammo, off, center)\n\n    const constraint = new Ammo.btGeneric6DofConstraint(\n      bodyA.ammo,\n      bodyB.ammo,\n      transform.transformA,\n      transform.transformB,\n      true\n    )\n\n    const { linearLowerLimit, linearUpperLimit, angularLowerLimit, angularUpperLimit } = config\n\n    const lll = this.toAmmoV3(linearLowerLimit)\n    const lul = this.toAmmoV3(linearUpperLimit)\n    const all = this.toAmmoV3(angularLowerLimit, -Math.PI)\n    const aul = this.toAmmoV3(angularUpperLimit, Math.PI)\n\n    constraint.setLinearLowerLimit(lll)\n    constraint.setLinearUpperLimit(lul)\n    constraint.setAngularLowerLimit(all)\n    constraint.setAngularUpperLimit(aul)\n\n    Ammo.destroy(lll)\n    Ammo.destroy(lul)\n    Ammo.destroy(all)\n    Ammo.destroy(aul)\n\n    this.physicsWorld.addConstraint(constraint, false)\n\n    return constraint\n  }\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport EventEmitter from 'eventemitter3'\nimport { ExtendedObject3D } from '@enable3d/common/dist/types'\n\nexport default class Events extends EventEmitter {\n  public tmpTrans: Ammo.btTransform\n  public physicsWorld: Ammo.btDiscreteDynamicsWorld\n\n  protected addCollider(\n    object1: ExtendedObject3D,\n    object2: ExtendedObject3D,\n    eventCallback: (event: 'start' | 'collision' | 'end') => void\n  ) {\n    if (!object1.body || !object2.body) return\n\n    object1.body.checkCollisions = true\n    object2.body.checkCollisions = true\n\n    this.on('collision', data => {\n      const { bodies, event } = data\n      if (bodies[0]?.name && bodies[1]?.name && object1?.name && object2?.name) {\n        if (bodies[0].name === object1.name && bodies[1].name === object2.name) eventCallback(event)\n        else if (bodies[1].name === object1.name && bodies[0].name === object2.name) eventCallback(event)\n      }\n    })\n  }\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @description  This is a modified version of the original code from Kevin Lee\n */\n\n/**\n * @author       Kevin Lee (https://github.com/InfiniteLee)\n * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/ammo-debug-drawer\n * @license      {@link https://github.com/InfiniteLee/ammo-debug-drawer/blob/master/LICENSE|MPL-2.0}\n */\n\nimport {\n  Scene,\n  BufferGeometry,\n  BufferAttribute,\n  LineBasicMaterial,\n  LineSegments,\n  StaticDrawUsage\n} from '@enable3d/three-wrapper/dist/index'\n\nconst AmmoDebugConstants = {\n  NoDebug: 0,\n  DrawWireframe: 1,\n  DrawAabb: 2,\n  DrawFeaturesText: 4,\n  DrawContactPoints: 8,\n  NoDeactivation: 16,\n  NoHelpText: 32,\n  DrawText: 64,\n  ProfileTimings: 128,\n  EnableSatComparison: 256,\n  DisableBulletLCP: 512,\n  EnableCCD: 1024,\n  DrawConstraints: 1 << 11, //2048\n  DrawConstraintLimits: 1 << 12, //4096\n  FastWireframe: 1 << 13, //8192\n  DrawNormals: 1 << 14, //16384\n  DrawOnTop: 1 << 15, //32768\n  MAX_DEBUG_DRAW_MODE: 0xffffffff\n}\n\n/**\n * An implementation of the btIDebugDraw interface in Ammo.js, for debug rendering of Ammo shapes\n */\nclass DebugDrawer {\n  debugDrawMode: number\n  geometry: BufferGeometry\n  index: number\n  mesh: LineSegments\n  enabled: boolean\n  debugDrawer: Ammo.DebugDrawer\n  warnedOnce: boolean\n  constructor(public scene: Scene, public world: Ammo.btCollisionWorld, public options: any = {}) {\n    this.debugDrawMode = options.debugDrawMode || AmmoDebugConstants.DrawWireframe\n    const drawOnTop = this.debugDrawMode & AmmoDebugConstants.DrawOnTop || false\n    const maxBufferSize = options.maxBufferSize || 1000000\n\n    this.geometry = new BufferGeometry()\n    const vertices = new Float32Array(maxBufferSize * 3)\n    const colors = new Float32Array(maxBufferSize * 3)\n\n    /*\n    I do not know the difference, just using the first one.\n    export const StaticDrawUsage: Usage;\n    export const DynamicDrawUsage: Usage;\n    export const StreamDrawUsage: Usage;\n    export const StaticReadUsage: Usage;\n    export const DynamicReadUsage: Usage;\n    export const StreamReadUsage: Usage;\n    export const StaticCopyUsage: Usage;\n    export const DynamicCopyUsage: Usage;\n    export const StreamCopyUsage: Usage;\n     */\n    this.geometry.setAttribute('position', new BufferAttribute(vertices, 3).setUsage(StaticDrawUsage))\n    this.geometry.setAttribute('color', new BufferAttribute(colors, 3).setUsage(StaticDrawUsage))\n\n    this.index = 0\n\n    const material = new LineBasicMaterial({\n      vertexColors: true,\n      depthTest: !drawOnTop\n    })\n\n    this.mesh = new LineSegments(this.geometry, material)\n    if (drawOnTop) this.mesh.renderOrder = 999\n    this.mesh.frustumCulled = false\n\n    this.enabled = false\n\n    this.debugDrawer = new Ammo.DebugDrawer()\n    this.debugDrawer.drawLine = this.drawLine.bind(this)\n    this.debugDrawer.drawContactPoint = this.drawContactPoint.bind(this)\n    this.debugDrawer.reportErrorWarning = this.reportErrorWarning.bind(this)\n    this.debugDrawer.draw3dText = this.draw3dText.bind(this)\n    this.debugDrawer.setDebugMode = this.setDebugMode.bind(this)\n    this.debugDrawer.getDebugMode = this.getDebugMode.bind(this)\n\n    this.world.setDebugDrawer(this.debugDrawer)\n  }\n\n  enable() {\n    this.enabled = true\n    this.scene.add(this.mesh)\n  }\n\n  disable() {\n    this.enabled = false\n    this.scene.remove(this.mesh)\n  }\n\n  update() {\n    if (!this.enabled) {\n      return\n    }\n\n    if (this.index != 0) {\n      // @ts-ignore\n      this.geometry.attributes.position.needsUpdate = true\n      // @ts-ignore\n      this.geometry.attributes.color.needsUpdate = true\n    }\n\n    this.index = 0\n    this.world.debugDrawWorld()\n    this.geometry.setDrawRange(0, this.index)\n  }\n\n  drawLine(from: any, to: any, color: any) {\n    // @ts-ignore\n    const heap = Ammo.HEAPF32\n    const r = heap[(color + 0) / 4]\n    const g = heap[(color + 4) / 4]\n    const b = heap[(color + 8) / 4]\n\n    const fromX = heap[(from + 0) / 4]\n    const fromY = heap[(from + 4) / 4]\n    const fromZ = heap[(from + 8) / 4]\n    this.geometry.attributes.position.setXYZ(this.index, fromX, fromY, fromZ)\n    this.geometry.attributes.color.setXYZ(this.index++, r, g, b)\n\n    const toX = heap[(to + 0) / 4]\n    const toY = heap[(to + 4) / 4]\n    const toZ = heap[(to + 8) / 4]\n    this.geometry.attributes.position.setXYZ(this.index, toX, toY, toZ)\n    this.geometry.attributes.color.setXYZ(this.index++, r, g, b)\n  }\n\n  //TODO: figure out how to make lifeTime work\n  drawContactPoint(pointOnB: any, normalOnB: any, distance: any, _lifeTime: any, color: any) {\n    // @ts-ignore\n    const heap = Ammo.HEAPF32\n    const r = heap[(color + 0) / 4]\n    const g = heap[(color + 4) / 4]\n    const b = heap[(color + 8) / 4]\n\n    const x = heap[(pointOnB + 0) / 4]\n    const y = heap[(pointOnB + 4) / 4]\n    const z = heap[(pointOnB + 8) / 4]\n    this.geometry.attributes.position.setXYZ(this.index, x, y, z)\n    this.geometry.attributes.color.setXYZ(this.index++, r, g, b)\n\n    const dx = heap[(normalOnB + 0) / 4] * distance\n    const dy = heap[(normalOnB + 4) / 4] * distance\n    const dz = heap[(normalOnB + 8) / 4] * distance\n    this.geometry.attributes.position.setXYZ(this.index, x + dx, y + dy, z + dz)\n    this.geometry.attributes.color.setXYZ(this.index++, r, g, b)\n  }\n\n  reportErrorWarning(warningString: string) {\n    if (Ammo.hasOwnProperty('Pointer_stringify')) {\n      // @ts-ignore\n      console.warn(Ammo.Pointer_stringify(warningString))\n    } else if (!this.warnedOnce) {\n      this.warnedOnce = true\n      console.warn(\"Cannot print warningString, please rebuild Ammo.js using 'debug' flag\")\n    }\n  }\n\n  draw3dText(_location: any, _textString: any) {\n    //TODO\n    console.warn('TODO: draw3dText')\n  }\n\n  setDebugMode(debugMode: any) {\n    this.debugDrawMode = debugMode\n  }\n\n  getDebugMode() {\n    return this.debugDrawMode\n  }\n}\n\nexport default DebugDrawer\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport DebugDrawer from './debugDrawer'\nimport EventEmitter from 'eventemitter3'\nimport { ExtendedObject3D, ThreeGraphicsConfig, ExtendedMesh } from '@enable3d/common/dist/types'\nimport { Vector3, Scene, Quaternion, Euler } from '@enable3d/three-wrapper/dist/index'\nimport { ConvexObjectBreaker } from './convexObjectBreaker'\nimport DefaultMaterial from '@enable3d/common/dist/defaultMaterial'\nimport PhysicsBody from '@enable3d/common/dist/physicsBody'\n\nclass Physics extends EventEmitter {\n  public tmpTrans: Ammo.btTransform\n  public physicsWorld: Ammo.btDiscreteDynamicsWorld\n  protected dispatcher: Ammo.btCollisionDispatcher\n  public rigidBodies: ExtendedObject3D[] = []\n  public objectsAmmo: { [ptr: number]: ExtendedObject3D } = {}\n  protected earlierDetectedCollisions: { combinedName: string; collision: boolean }[] = []\n  protected debugDrawer: DebugDrawer\n  private convexBreaker: any\n  protected addRigidBody: (threeObject: ExtendedObject3D, physicsShape: any, mass: any, pos: any, quat: any) => void\n  private objectsToRemove: any[]\n  private numObjectsToRemove: number\n  protected gravity: { x: number; y: number; z: number }\n\n  protected emptyV3: Vector3\n  protected impactPoint: Vector3\n  protected impactNormal: Vector3\n\n  protected tmpEuler: Euler\n  protected tmpQuaternion: Quaternion\n  protected tmpVector3: Vector3\n  protected tmpBtVector3: Ammo.btVector3\n  protected tmpBtQuaternion: Ammo.btQuaternion\n\n  protected defaultMaterial: DefaultMaterial\n\n  constructor(protected scene: Scene | 'headless', public config: ThreeGraphicsConfig = {}) {\n    super()\n  }\n\n  /** Destroys a physics body. */\n  public destroy(body: PhysicsBody | ExtendedObject3D | ExtendedMesh) {\n    // @ts-ignore\n    const b: PhysicsBody = Object.keys(body).includes('body') ? body.body : body\n\n    if (typeof b?.ammo === 'undefined') return\n\n    const ptr = Object.values(b.ammo)[0]\n    const name = Object.values(b.ammo)[1]\n    const obj = this.objectsAmmo[ptr]\n\n    // TODO: Remember why I track objectsAmmo and rigidBodies?\n    // console.log(this.objectsAmmo)\n    // console.log(this.rigidBodies)\n\n    if (ptr && name && obj) {\n      if (obj?.body?.ammo) {\n        // remove from physics world\n        this.physicsWorld.removeRigidBody(obj.body.ammo)\n\n        // call destructor on body\n        obj.body.destructor()\n\n        // reset properties\n        // @ts-ignore\n        obj.body = undefined\n        obj.hasBody = false\n\n        // remove from this.objectAmmo\n        delete this.objectsAmmo[ptr]\n        // remove from this.rigidBodies\n        for (var i = 0; i < this.rigidBodies.length; i++) {\n          if (this.rigidBodies[i].name === name) {\n            this.rigidBodies.splice(i, 1)\n            i--\n          }\n        }\n      }\n    }\n\n    // @ts-ignore\n    if (this.scene === 'headless' && obj) obj = null\n  }\n\n  protected setup() {\n    if (this.scene !== 'headless') {\n      // Initialize convexBreaker\n      // @ts-ignore\n      this.convexBreaker = new ConvexObjectBreaker()\n\n      this.objectsToRemove = []\n      this.numObjectsToRemove = 0\n      for (var i = 0; i < 500; i++) {\n        this.objectsToRemove[i] = null\n      }\n    }\n\n    // setup ammo physics\n    this.setupPhysicsWorld()\n\n    if (this.scene !== 'headless') this.debugDrawer = new DebugDrawer(this.scene, this.physicsWorld, {})\n\n    /**\n     * TODO add ghost object\n     */\n    // const ghost = new Ammo.btGhostObject()\n    // ghost.setCollisionShape(new Ammo.btSphereShape(10))\n    // ghost.setWorldTransform(new Ammo.btTransform(new Ammo.btQuaternion(0, 0, 0, 1), new Ammo.btVector3(0, 15, 0)))\n    // ghost.setCollisionFlags(4)\n    // this.physicsWorld.addCollisionObject(ghost)\n\n    // run the phaser update method\n    /*if (!this.phaser3D.isXrEnabled)\n      this.scene.events.on('update', (_time: number, delta: number) => {\n        this.update(delta)\n        this.updateDebugger()\n      })*/\n  }\n\n  public updateDebugger() {\n    if (this.scene === 'headless') return\n\n    if (this.debugDrawer && this.debugDrawer.enabled) this.debugDrawer.update()\n  }\n\n  protected setupPhysicsWorld() {\n    const g = this.gravity\n\n    const collisionConfiguration = new Ammo.btDefaultCollisionConfiguration()\n    const dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguration)\n    const broadphase = new Ammo.btDbvtBroadphase()\n    const solver = new Ammo.btSequentialImpulseConstraintSolver()\n    this.physicsWorld = new Ammo.btDiscreteDynamicsWorld(dispatcher, broadphase, solver, collisionConfiguration)\n    this.physicsWorld.setGravity(new Ammo.btVector3(g.x, g.y, g.z))\n\n    this.dispatcher = dispatcher\n    this.tmpTrans = new Ammo.btTransform()\n  }\n\n  private createDebrisFromBreakableObject(object: ExtendedObject3D, parent: ExtendedObject3D) {\n    if (this.scene === 'headless') return\n\n    object.material = this.defaultMaterial.get()\n    object.shape = 'hull'\n    object.fragmentDepth = parent.fragmentDepth + 1\n\n    // Add the object to the scene\n    this.scene.add(object)\n\n    // Add physics to the object\n    // @ts-ignore\n    this.addExisting(object)\n\n    object.body.breakable = false\n    // make this fragment breakable in 2.5seconds\n    setTimeout(() => {\n      object.body.breakable = true\n    }, 2500)\n  }\n\n  private removeDebris(object: any) {\n    if (this.scene === 'headless') return\n\n    this.scene.remove(object)\n    this.physicsWorld.removeRigidBody(object.body.ammo)\n    delete this.objectsAmmo[object.ptr]\n  }\n\n  public update(delta: number) {\n    // reset these vectors\n    this.impactPoint.set(0, 0, 0)\n    this.impactNormal.set(0, 0, 0)\n\n    const detectedCollisions: { combinedName: string; collision: boolean }[] = []\n\n    // Step world\n    const deltaTime = delta / 1000\n    this.physicsWorld.stepSimulation(deltaTime, this.config.maxSubSteps || 1, this.config.fixedTimeStep || 1 / 60)\n\n    /**\n     * Update rigid bodies\n     */\n    for (var i = 0, il = this.rigidBodies.length; i < il; i++) {\n      var objThree = this.rigidBodies[i]\n      var objPhys = objThree.body.ammo\n      var ms = objPhys.getMotionState()\n\n      if (ms) {\n        ms.getWorldTransform(this.tmpTrans)\n\n        // check if object did an update since last call\n        if (objThree.body.didUpdate) {\n          // @ts-ignore\n          if (objThree.body._emitUpdateEvents) objThree.body.eventEmitter.emit('update')\n          objThree.body.didUpdate = false\n        }\n\n        // update positions\n        if (objThree.body.ammo.isKinematicObject() && objThree.body.needUpdate) {\n          // get position and rotation\n          objThree.getWorldQuaternion(this.tmpQuaternion)\n          objThree.getWorldPosition(this.tmpVector3)\n          // adjust tmp variables\n          this.tmpBtVector3.setValue(this.tmpVector3.x, this.tmpVector3.y, this.tmpVector3.z)\n          this.tmpBtQuaternion.setValue(\n            this.tmpQuaternion.x,\n            this.tmpQuaternion.y,\n            this.tmpQuaternion.z,\n            this.tmpQuaternion.w\n          )\n          // set position and rotation\n          this.tmpTrans.setOrigin(this.tmpBtVector3)\n          this.tmpTrans.setRotation(this.tmpBtQuaternion)\n          // set transform\n          ms.setWorldTransform(this.tmpTrans)\n          // reset needsUpdate\n          objThree.body.needUpdate = false\n        } else {\n          // get position and rotation\n          let p = this.tmpTrans.getOrigin()\n          let q = this.tmpTrans.getRotation()\n          // body offset\n          let o = objThree.body.offset\n          // set position and rotation\n          objThree.position.set(p.x() + o.x, p.y() + o.y, p.z() + o.z)\n          objThree.quaternion.set(q.x(), q.y(), q.z(), q.w())\n        }\n\n        objThree.body.collided = false\n      }\n    }\n\n    /**\n     * Check collisions\n     */\n    for (var i = 0, il = this.dispatcher.getNumManifolds(); i < il; i++) {\n      const contactManifold = this.dispatcher.getManifoldByIndexInternal(i)\n      const key = Object.keys(contactManifold.getBody0())[0]\n\n      // @ts-ignore\n      const body0 = Ammo.castObject(contactManifold.getBody0(), Ammo.btRigidBody)\n      // @ts-ignore\n      const body1 = Ammo.castObject(contactManifold.getBody1(), Ammo.btRigidBody)\n\n      // do not check collision between 2 unnamed objects\n      // (fragments do not have a name, for example)\n      if (body0.name === '' && body1.name === '') continue\n\n      // @ts-ignore\n      const ptr0 = body0[key]\n      // @ts-ignore\n      const ptr1 = body1[key]\n      const threeObject0 = this.objectsAmmo[ptr0] as ExtendedObject3D\n      const threeObject1 = this.objectsAmmo[ptr1] as ExtendedObject3D\n\n      if (!threeObject0 || !threeObject1) {\n        continue\n      }\n\n      /**\n       * Get some information\n       */\n      const breakable0 = threeObject0.body.breakable\n      const breakable1 = threeObject1.body.breakable\n\n      const collided0 = threeObject0.body.collided\n      const collided1 = threeObject1.body.collided\n\n      const checkCollisions0 = threeObject0.body?.checkCollisions\n      const checkCollisions1 = threeObject1.body?.checkCollisions\n\n      /**\n       * Handle collision events\n       */\n      if (checkCollisions0 || checkCollisions1) {\n        // check if a collision between these object has already been processed\n        const names = [threeObject0.name, threeObject1.name].sort()\n        const combinedName = `${names[0]}__${names[1]}`\n        let event\n        if (this.earlierDetectedCollisions.find(el => el.combinedName === combinedName)) event = 'colliding'\n        else event = 'start'\n        detectedCollisions.push({ combinedName, collision: true })\n        this.emit('collision', { bodies: [threeObject0, threeObject1], event })\n      }\n\n      if ((!breakable0 && !breakable1) || (collided0 && collided1)) {\n        continue\n      }\n\n      let contact = false\n      let maxImpulse = 0\n      for (var j = 0, jl = contactManifold.getNumContacts(); j < jl; j++) {\n        var contactPoint = contactManifold.getContactPoint(j)\n\n        if (contactPoint.getDistance() < 0) {\n          contact = true\n          var impulse = contactPoint.getAppliedImpulse()\n\n          if (impulse > maxImpulse) {\n            maxImpulse = impulse\n            var pos = contactPoint.get_m_positionWorldOnB()\n            var normal = contactPoint.get_m_normalWorldOnB()\n            this.impactPoint.set(pos.x(), pos.y(), pos.z())\n            this.impactNormal.set(normal.x(), normal.y(), normal.z())\n          }\n\n          break\n        }\n      }\n\n      // If no point has contact, abort\n      if (!contact) continue\n\n      /**\n       * Check for breakable objects (subdivision)\n       */\n      const fractureImpulse = 5 //250\n      const MAX_FRAGMENT_DEPTH = 2\n\n      // since the library convexBreaker makes use of three's userData\n      // we have to clone the necessary params to threeObjectX.userData\n      // TODO improve this\n\n      this.emptyV3.set(0, 0, 0)\n      threeObject0.userData = {\n        mass: 1,\n        velocity: this.emptyV3,\n        angularVelocity: this.emptyV3,\n        breakable: breakable0,\n        physicsBody: body0\n      }\n      threeObject1.userData = {\n        mass: 1,\n        velocity: this.emptyV3,\n        angularVelocity: this.emptyV3,\n        breakable: breakable1,\n        physicsBody: body1\n      }\n      if (typeof threeObject0.fragmentDepth === 'undefined') threeObject0.fragmentDepth = 0\n      if (typeof threeObject1.fragmentDepth === 'undefined') threeObject1.fragmentDepth = 0\n\n      // threeObject0\n      if (breakable0 && !collided0 && maxImpulse > fractureImpulse && threeObject0.fragmentDepth < MAX_FRAGMENT_DEPTH) {\n        var debris = this.convexBreaker.subdivideByImpact(threeObject0, this.impactPoint, this.impactNormal, 1, 2) //, 1.5)\n\n        var numObjects = debris.length\n        for (var j = 0; j < numObjects; j++) {\n          var vel = body0.getLinearVelocity()\n          var angVel = body0.getAngularVelocity()\n          var fragment = debris[j] as ExtendedObject3D\n          fragment.userData.velocity.set(vel.x(), vel.y(), vel.z())\n          fragment.userData.angularVelocity.set(angVel.x(), angVel.y(), angVel.z())\n\n          this.createDebrisFromBreakableObject(fragment, threeObject0)\n        }\n\n        this.objectsToRemove[this.numObjectsToRemove++] = threeObject0\n        threeObject0.body.collided = true\n      }\n\n      // threeObject1\n      if (breakable1 && !collided1 && maxImpulse > fractureImpulse && threeObject1.fragmentDepth < MAX_FRAGMENT_DEPTH) {\n        var debris = this.convexBreaker.subdivideByImpact(threeObject1, this.impactPoint, this.impactNormal, 1, 2) //, 1.5)\n\n        var numObjects = debris.length\n        for (var j = 0; j < numObjects; j++) {\n          var vel = body1.getLinearVelocity()\n          var angVel = body1.getAngularVelocity()\n          var fragment = debris[j] as ExtendedObject3D\n          fragment.userData.velocity.set(vel.x(), vel.y(), vel.z())\n          fragment.userData.angularVelocity.set(angVel.x(), angVel.y(), angVel.z())\n\n          this.createDebrisFromBreakableObject(fragment, threeObject1)\n        }\n\n        this.objectsToRemove[this.numObjectsToRemove++] = threeObject1\n        threeObject1.body.collided = true\n      }\n    }\n\n    /**\n     * Remove objects\n     */\n    for (var i = 0; i < this.numObjectsToRemove; i++) {\n      this.removeDebris(this.objectsToRemove[i])\n    }\n    this.numObjectsToRemove = 0\n\n    /**\n     * Handle collision end events\n     */\n    this.earlierDetectedCollisions.forEach(el => {\n      const { combinedName } = el\n      if (!detectedCollisions.find(el => el.combinedName === combinedName)) {\n        const split = combinedName.split('__')\n        const obj0 = this.rigidBodies.find(obj => obj.name === split[0])\n        const obj1 = this.rigidBodies.find(obj => obj.name === split[1])\n        if (obj0 && obj1) this.emit('collision', { bodies: [obj0, obj1], event: 'end' })\n      }\n    })\n    this.earlierDetectedCollisions = [...detectedCollisions]\n  }\n}\n\nexport default Physics\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @description  This is a modified version of the original code from Kevin Lee\n */\n\n/**\n * @author       Kevin Lee (https://github.com/InfiniteLee)\n * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo\n * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}\n */\n\n'use strict'\n/* global Ammo */\n\nconst TYPE = {\n  BOX: 'box',\n  CYLINDER: 'cylinder',\n  SPHERE: 'sphere',\n  CAPSULE: 'capsule',\n  CONE: 'cone',\n  HULL: 'hull',\n  HACD: 'hacd', //Hierarchical Approximate Convex Decomposition\n  VHACD: 'vhacd', //Volumetric Hierarchical Approximate Convex Decomposition\n  MESH: 'mesh',\n  HEIGHTFIELD: 'heightfield'\n}\n\nconst FIT = {\n  ALL: 'all', //A single shape is automatically sized to bound all meshes within the entity.\n  MANUAL: 'manual' //A single shape is sized manually. Requires halfExtents or sphereRadius.\n}\n\nconst HEIGHTFIELD_DATA_TYPE = {\n  short: 'short',\n  float: 'float'\n}\n\nimport ExtendedObject3d from '@enable3d/common/dist/extendedObject3D'\nimport { Vector3, Matrix4, BufferGeometry, Quaternion, Box3 } from '@enable3d/three-wrapper/dist/index'\nimport logger from '@enable3d/common/dist/logger'\n\nconst hasUpdateMatricesFunction = ExtendedObject3d.prototype.hasOwnProperty('updateMatrices')\n\nexport const createCollisionShapes = function (root, options) {\n  switch (options.type) {\n    case TYPE.BOX:\n      return createBoxShape(root, options)\n    case TYPE.CYLINDER:\n      return createCylinderShape(root, options)\n    case TYPE.CAPSULE:\n      return createCapsuleShape(root, options)\n    case TYPE.CONE:\n      return createConeShape(root, options)\n    case TYPE.SPHERE:\n      return createSphereShape(root, options)\n    case TYPE.HULL:\n      return createHullShape(root, options)\n    case TYPE.HACD:\n      return createHACDShapes(root, options)\n    case TYPE.VHACD:\n      return createVHACDShapes(root, options)\n    case TYPE.MESH:\n      return createTriMeshShape(root, options)\n    case TYPE.HEIGHTFIELD:\n      return createHeightfieldTerrainShape(root, options)\n    default:\n      logger(options.type + ' is not currently supported')\n      return []\n  }\n}\n\n//TODO: support gimpact (dynamic trimesh) and heightmap\n\nexport const createBoxShape = function (root, options) {\n  options.type = TYPE.BOX\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    options.halfExtents = _computeHalfExtents(\n      root,\n      _computeBounds(root, options),\n      options.minHalfExtent,\n      options.maxHalfExtent\n    )\n  }\n\n  const btHalfExtents = new Ammo.btVector3(options.halfExtents.x, options.halfExtents.y, options.halfExtents.z)\n  const collisionShape = new Ammo.btBoxShape(btHalfExtents)\n  Ammo.destroy(btHalfExtents)\n\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n  return collisionShape\n}\n\nexport const createCylinderShape = function (root, options) {\n  options.type = TYPE.CYLINDER\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    options.halfExtents = _computeHalfExtents(\n      root,\n      _computeBounds(root, options),\n      options.minHalfExtent,\n      options.maxHalfExtent\n    )\n  }\n\n  const btHalfExtents = new Ammo.btVector3(options.halfExtents.x, options.halfExtents.y, options.halfExtents.z)\n  const collisionShape = (() => {\n    switch (options.cylinderAxis) {\n      case 'y':\n        return new Ammo.btCylinderShape(btHalfExtents)\n      case 'x':\n        return new Ammo.btCylinderShapeX(btHalfExtents)\n      case 'z':\n        return new Ammo.btCylinderShapeZ(btHalfExtents)\n    }\n    return null\n  })()\n  Ammo.destroy(btHalfExtents)\n\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n  return collisionShape\n}\n\nexport const createCapsuleShape = function (root, options) {\n  options.type = TYPE.CAPSULE\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    options.halfExtents = _computeHalfExtents(\n      root,\n      _computeBounds(root, options),\n      options.minHalfExtent,\n      options.maxHalfExtent\n    )\n  }\n\n  const { x, y, z } = options.halfExtents\n  const collisionShape = (() => {\n    switch (options.cylinderAxis) {\n      case 'y':\n        return new Ammo.btCapsuleShape(Math.max(x, z), y * 2)\n      case 'x':\n        return new Ammo.btCapsuleShapeX(Math.max(y, z), x * 2)\n      case 'z':\n        return new Ammo.btCapsuleShapeZ(Math.max(x, y), z * 2)\n    }\n    return null\n  })()\n\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n  return collisionShape\n}\n\nexport const createConeShape = function (root, options) {\n  options.type = TYPE.CONE\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    options.halfExtents = _computeHalfExtents(\n      root,\n      _computeBounds(root, options),\n      options.minHalfExtent,\n      options.maxHalfExtent\n    )\n  }\n\n  const { x, y, z } = options.halfExtents\n  const collisionShape = (() => {\n    switch (options.cylinderAxis) {\n      case 'y':\n        return new Ammo.btConeShape(Math.max(x, z), y * 2)\n      case 'x':\n        return new Ammo.btConeShapeX(Math.max(y, z), x * 2)\n      case 'z':\n        return new Ammo.btConeShapeZ(Math.max(x, y), z * 2)\n    }\n    return null\n  })()\n\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n  return collisionShape\n}\n\nexport const createSphereShape = function (root, options) {\n  options.type = TYPE.SPHERE\n  _setOptions(options)\n\n  let radius\n  if (options.fit === FIT.MANUAL && !isNaN(options.sphereRadius)) {\n    radius = options.sphereRadius\n  } else {\n    radius = _computeRadius(root, options, _computeBounds(root, options))\n  }\n\n  const collisionShape = new Ammo.btSphereShape(radius)\n  _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n\n  return collisionShape\n}\n\nexport const createHullShape = (function () {\n  const vertex = new Vector3()\n  const center = new Vector3()\n  return function (root, options) {\n    options.type = TYPE.HULL\n    _setOptions(options)\n\n    if (options.fit === FIT.MANUAL) {\n      console.warn('cannot use fit: manual with type: hull')\n      return null\n    }\n\n    const bounds = _computeBounds(root, options)\n\n    const btVertex = new Ammo.btVector3()\n    const originalHull = new Ammo.btConvexHullShape()\n    originalHull.setMargin(options.margin)\n    center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5)\n\n    let vertexCount = 0\n    _iterateGeometries(root, options, geo => {\n      vertexCount += geo.attributes.position.array.length / 3\n    })\n\n    const maxVertices = options.hullMaxVertices || 100000\n    // todo: might want to implement this in a deterministic way that doesn't do O(verts) calls to Math.random\n    if (vertexCount > maxVertices) {\n      console.warn(`too many vertices for hull shape; sampling ~${maxVertices} from ~${vertexCount} vertices`)\n    }\n    const p = Math.min(1, maxVertices / vertexCount)\n\n    _iterateGeometries(root, options, (geo, transform) => {\n      adjustGeometryTranslateEXPERIMENTAL(geo, transform)\n\n      const components = geo.attributes.position.array\n      for (let i = 0; i < components.length; i += 3) {\n        if (Math.random() <= p) {\n          vertex\n            .set(components[i], components[i + 1], components[i + 2])\n            .applyMatrix4(transform)\n            .sub(center)\n          btVertex.setValue(vertex.x, vertex.y, vertex.z)\n          originalHull.addPoint(btVertex, i === components.length - 3) // todo: better to recalc AABB only on last geometry\n        }\n      }\n    })\n\n    let collisionShape = originalHull\n    if (originalHull.getNumVertices() >= 100) {\n      //Bullet documentation says don't use convexHulls with 100 verts or more\n      const shapeHull = new Ammo.btShapeHull(originalHull)\n      shapeHull.buildHull(options.margin)\n      Ammo.destroy(originalHull)\n      collisionShape = new Ammo.btConvexHullShape(\n        Ammo.getPointer(shapeHull.getVertexPointer()),\n        shapeHull.numVertices()\n      )\n      Ammo.destroy(shapeHull) // btConvexHullShape makes a copy\n    }\n\n    Ammo.destroy(btVertex)\n\n    _finishCollisionShape(collisionShape, options, _computeScale(root, options))\n    return collisionShape\n  }\n})()\n\nexport const createHACDShapes = (function () {\n  const v = new Vector3()\n  const center = new Vector3()\n  return function (root, options) {\n    options.type = TYPE.HACD\n    _setOptions(options)\n\n    if (options.fit === FIT.MANUAL) {\n      console.warn('cannot use fit: manual with type: hacd')\n      return []\n    }\n\n    if (!Ammo.hasOwnProperty('HACD')) {\n      console.warn(\n        'HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version.'\n      )\n      return []\n    }\n\n    const bounds = _computeBounds(root)\n    const scale = _computeScale(root, options)\n\n    let vertexCount = 0\n    let triCount = 0\n    center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5)\n\n    _iterateGeometries(root, options, geo => {\n      vertexCount += geo.attributes.position.array.length / 3\n      if (geo.index) {\n        triCount += geo.index.array.length / 3\n      } else {\n        triCount += geo.attributes.position.array.length / 9\n      }\n    })\n\n    const hacd = new Ammo.HACD()\n    if (options.hasOwnProperty('compacityWeight')) hacd.SetCompacityWeight(options.compacityWeight)\n    if (options.hasOwnProperty('volumeWeight')) hacd.SetVolumeWeight(options.volumeWeight)\n    if (options.hasOwnProperty('nClusters')) hacd.SetNClusters(options.nClusters)\n    if (options.hasOwnProperty('nVerticesPerCH')) hacd.SetNVerticesPerCH(options.nVerticesPerCH)\n    if (options.hasOwnProperty('concavity')) hacd.SetConcavity(options.concavity)\n\n    const points = Ammo._malloc(vertexCount * 3 * 8)\n    const triangles = Ammo._malloc(triCount * 3 * 4)\n    hacd.SetPoints(points)\n    hacd.SetTriangles(triangles)\n    hacd.SetNPoints(vertexCount)\n    hacd.SetNTriangles(triCount)\n\n    const pptr = points / 8,\n      tptr = triangles / 4\n    _iterateGeometries(root, options, (geo, transform) => {\n      adjustGeometryTranslateEXPERIMENTAL(geo, transform)\n\n      const components = geo.attributes.position.array\n      const indices = geo.index ? geo.index.array : null\n      for (let i = 0; i < components.length; i += 3) {\n        v.set(components[i + 0], components[i + 1], components[i + 2])\n          .applyMatrix4(transform)\n          .sub(center)\n        Ammo.HEAPF64[pptr + i + 0] = v.x\n        Ammo.HEAPF64[pptr + i + 1] = v.y\n        Ammo.HEAPF64[pptr + i + 2] = v.z\n      }\n      if (indices) {\n        for (let i = 0; i < indices.length; i++) {\n          Ammo.HEAP32[tptr + i] = indices[i]\n        }\n      } else {\n        for (let i = 0; i < components.length / 3; i++) {\n          Ammo.HEAP32[tptr + i] = i\n        }\n      }\n    })\n\n    hacd.Compute()\n    Ammo._free(points)\n    Ammo._free(triangles)\n    const nClusters = hacd.GetNClusters()\n\n    const shapes = []\n    for (let i = 0; i < nClusters; i++) {\n      const hull = new Ammo.btConvexHullShape()\n      hull.setMargin(options.margin)\n      const nPoints = hacd.GetNPointsCH(i)\n      const nTriangles = hacd.GetNTrianglesCH(i)\n      const hullPoints = Ammo._malloc(nPoints * 3 * 8)\n      const hullTriangles = Ammo._malloc(nTriangles * 3 * 4)\n      hacd.GetCH(i, hullPoints, hullTriangles)\n\n      const pptr = hullPoints / 8\n      for (let pi = 0; pi < nPoints; pi++) {\n        const btVertex = new Ammo.btVector3()\n        const px = Ammo.HEAPF64[pptr + pi * 3 + 0]\n        const py = Ammo.HEAPF64[pptr + pi * 3 + 1]\n        const pz = Ammo.HEAPF64[pptr + pi * 3 + 2]\n        btVertex.setValue(px, py, pz)\n        hull.addPoint(btVertex, pi === nPoints - 1)\n        Ammo.destroy(btVertex)\n      }\n\n      _finishCollisionShape(hull, options, scale)\n      shapes.push(hull)\n    }\n\n    return shapes\n  }\n})()\n\nexport const createVHACDShapes = (function () {\n  const v = new Vector3()\n  const center = new Vector3()\n  return function (root, options) {\n    options.type = TYPE.VHACD\n    _setOptions(options)\n\n    if (options.fit === FIT.MANUAL) {\n      console.warn('cannot use fit: manual with type: vhacd')\n      return []\n    }\n\n    if (!Ammo.hasOwnProperty('VHACD')) {\n      console.warn(\n        'VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version.'\n      )\n      return []\n    }\n\n    const bounds = _computeBounds(root, options)\n    const scale = _computeScale(root, options)\n\n    let vertexCount = 0\n    let triCount = 0\n    center.addVectors(bounds.max, bounds.min).multiplyScalar(0.5)\n\n    _iterateGeometries(root, options, geo => {\n      vertexCount += geo.attributes.position.count\n      if (geo.index) {\n        triCount += geo.index.count / 3\n      } else {\n        triCount += geo.attributes.position.count / 3\n      }\n    })\n\n    const vhacd = new Ammo.VHACD()\n    const params = new Ammo.Parameters()\n    //https://kmamou.blogspot.com/2014/12/v-hacd-20-parameters-description.html\n    if (options.hasOwnProperty('resolution')) params.set_m_resolution(options.resolution)\n    if (options.hasOwnProperty('depth')) params.set_m_depth(options.depth)\n    if (options.hasOwnProperty('concavity')) params.set_m_concavity(options.concavity)\n    if (options.hasOwnProperty('planeDownsampling')) params.set_m_planeDownsampling(options.planeDownsampling)\n    if (options.hasOwnProperty('convexhullDownsampling'))\n      params.set_m_convexhullDownsampling(options.convexhullDownsampling)\n    if (options.hasOwnProperty('alpha')) params.set_m_alpha(options.alpha)\n    if (options.hasOwnProperty('beta')) params.set_m_beta(options.beta)\n    if (options.hasOwnProperty('gamma')) params.set_m_gamma(options.gamma)\n    if (options.hasOwnProperty('pca')) params.set_m_pca(options.pca)\n    if (options.hasOwnProperty('mode')) params.set_m_mode(options.mode)\n    if (options.hasOwnProperty('maxNumVerticesPerCH')) params.set_m_maxNumVerticesPerCH(options.maxNumVerticesPerCH)\n    if (options.hasOwnProperty('minVolumePerCH')) params.set_m_minVolumePerCH(options.minVolumePerCH)\n    if (options.hasOwnProperty('convexhullApproximation'))\n      params.set_m_convexhullApproximation(options.convexhullApproximation)\n    if (options.hasOwnProperty('oclAcceleration')) params.set_m_oclAcceleration(options.oclAcceleration)\n\n    const points = Ammo._malloc(vertexCount * 3 * 8)\n    const triangles = Ammo._malloc(triCount * 3 * 4)\n\n    let pptr = points / 8,\n      tptr = triangles / 4\n    _iterateGeometries(root, options, (geo, transform) => {\n      adjustGeometryTranslateEXPERIMENTAL(geo, transform)\n\n      const components = geo.attributes.position.array\n      const indices = geo.index ? geo.index.array : null\n      for (let i = 0; i < components.length; i += 3) {\n        v.set(components[i + 0], components[i + 1], components[i + 2])\n          .applyMatrix4(transform)\n          .sub(center)\n        Ammo.HEAPF64[pptr + 0] = v.x\n        Ammo.HEAPF64[pptr + 1] = v.y\n        Ammo.HEAPF64[pptr + 2] = v.z\n        pptr += 3\n      }\n      if (indices) {\n        for (let i = 0; i < indices.length; i++) {\n          Ammo.HEAP32[tptr] = indices[i]\n          tptr++\n        }\n      } else {\n        for (let i = 0; i < components.length / 3; i++) {\n          Ammo.HEAP32[tptr] = i\n          tptr++\n        }\n      }\n    })\n\n    vhacd.Compute(points, 3, vertexCount, triangles, 3, triCount, params)\n    Ammo._free(points)\n    Ammo._free(triangles)\n    const nHulls = vhacd.GetNConvexHulls()\n\n    const shapes = []\n    const ch = new Ammo.ConvexHull()\n    for (let i = 0; i < nHulls; i++) {\n      vhacd.GetConvexHull(i, ch)\n      const nPoints = ch.get_m_nPoints()\n      const hullPoints = ch.get_m_points()\n\n      const hull = new Ammo.btConvexHullShape()\n      hull.setMargin(options.margin)\n\n      for (let pi = 0; pi < nPoints; pi++) {\n        const btVertex = new Ammo.btVector3()\n        const px = ch.get_m_points(pi * 3 + 0)\n        const py = ch.get_m_points(pi * 3 + 1)\n        const pz = ch.get_m_points(pi * 3 + 2)\n        btVertex.setValue(px, py, pz)\n        hull.addPoint(btVertex, pi === nPoints - 1)\n        Ammo.destroy(btVertex)\n      }\n\n      _finishCollisionShape(hull, options, scale)\n      shapes.push(hull)\n    }\n    Ammo.destroy(ch)\n    Ammo.destroy(vhacd)\n\n    return shapes\n  }\n})()\n\nexport const createTriMeshShape = (function () {\n  const va = new Vector3()\n  const vb = new Vector3()\n  const vc = new Vector3()\n  return function (root, options) {\n    options.type = TYPE.MESH\n    _setOptions(options)\n\n    if (options.fit === FIT.MANUAL) {\n      console.warn('cannot use fit: manual with type: mesh')\n      return null\n    }\n\n    const scale = _computeScale(root, options)\n\n    const bta = new Ammo.btVector3()\n    const btb = new Ammo.btVector3()\n    const btc = new Ammo.btVector3()\n    const triMesh = new Ammo.btTriangleMesh(true, false)\n\n    _iterateGeometries(root, options, (geo, transform) => {\n      const components = geo.attributes.position.array\n      if (geo.index) {\n        for (let i = 0; i < geo.index.count; i += 3) {\n          const ai = geo.index.array[i] * 3\n          const bi = geo.index.array[i + 1] * 3\n          const ci = geo.index.array[i + 2] * 3\n          va.set(components[ai], components[ai + 1], components[ai + 2]).applyMatrix4(transform)\n          vb.set(components[bi], components[bi + 1], components[bi + 2]).applyMatrix4(transform)\n          vc.set(components[ci], components[ci + 1], components[ci + 2]).applyMatrix4(transform)\n          bta.setValue(va.x, va.y, va.z)\n          btb.setValue(vb.x, vb.y, vb.z)\n          btc.setValue(vc.x, vc.y, vc.z)\n          triMesh.addTriangle(bta, btb, btc, false)\n        }\n      } else {\n        for (let i = 0; i < components.length; i += 9) {\n          va.set(components[i + 0], components[i + 1], components[i + 2]).applyMatrix4(transform)\n          vb.set(components[i + 3], components[i + 4], components[i + 5]).applyMatrix4(transform)\n          vc.set(components[i + 6], components[i + 7], components[i + 8]).applyMatrix4(transform)\n          bta.setValue(va.x, va.y, va.z)\n          btb.setValue(vb.x, vb.y, vb.z)\n          btc.setValue(vc.x, vc.y, vc.z)\n          triMesh.addTriangle(bta, btb, btc, false)\n        }\n      }\n    })\n\n    let collisionShape\n    if (options.concave) collisionShape = new Ammo.btBvhTriangleMeshShape(triMesh, true, true)\n    else collisionShape = new Ammo.btConvexTriangleMeshShape(triMesh, true)\n\n    collisionShape.resources = [triMesh]\n\n    Ammo.destroy(bta)\n    Ammo.destroy(btb)\n    Ammo.destroy(btc)\n\n    _finishCollisionShape(collisionShape, options, scale)\n    return collisionShape\n  }\n})()\n\nexport const createHeightfieldTerrainShape = function (root, options) {\n  _setOptions(options)\n\n  if (options.fit === FIT.ALL) {\n    console.warn('cannot use fit: all with type: heightfield')\n    return null\n  }\n  const heightfieldDistance = options.heightfieldDistance || 1\n  const heightfieldData = options.heightfieldData || []\n  const heightScale = options.heightScale || 0\n  const upAxis = options.hasOwnProperty('upAxis') ? options.upAxis : 1 // x = 0; y = 1; z = 2\n  const hdt = (() => {\n    switch (options.heightDataType) {\n      case 'short':\n        return Ammo.PHY_SHORT\n      case 'float':\n        return Ammo.PHY_FLOAT\n      default:\n        return Ammo.PHY_FLOAT\n    }\n  })()\n  const flipQuadEdges = options.hasOwnProperty('flipQuadEdges') ? options.flipQuadEdges : true\n\n  const heightStickLength = heightfieldData.length\n  const heightStickWidth = heightStickLength > 0 ? heightfieldData[0].length : 0\n\n  const data = Ammo._malloc(heightStickLength * heightStickWidth * 4)\n  const ptr = data / 4\n\n  let minHeight = Number.POSITIVE_INFINITY\n  let maxHeight = Number.NEGATIVE_INFINITY\n  let index = 0\n  for (let l = 0; l < heightStickLength; l++) {\n    for (let w = 0; w < heightStickWidth; w++) {\n      const height = heightfieldData[l][w]\n      Ammo.HEAPF32[ptr + index] = height\n      index++\n      minHeight = Math.min(minHeight, height)\n      maxHeight = Math.max(maxHeight, height)\n    }\n  }\n\n  const collisionShape = new Ammo.btHeightfieldTerrainShape(\n    heightStickWidth,\n    heightStickLength,\n    data,\n    heightScale,\n    minHeight,\n    maxHeight,\n    upAxis,\n    hdt,\n    flipQuadEdges\n  )\n\n  const scale = new Ammo.btVector3(heightfieldDistance, 1, heightfieldDistance)\n  collisionShape.setLocalScaling(scale)\n  Ammo.destroy(scale)\n\n  collisionShape.heightfieldData = data\n\n  _finishCollisionShape(collisionShape, options)\n  return collisionShape\n}\n\nfunction _setOptions(options) {\n  options.fit = options.hasOwnProperty('fit') ? options.fit : FIT.ALL\n  options.type = options.type || TYPE.HULL\n  options.minHalfExtent = options.hasOwnProperty('minHalfExtent') ? options.minHalfExtent : 0\n  options.maxHalfExtent = options.hasOwnProperty('maxHalfExtent') ? options.maxHalfExtent : Number.POSITIVE_INFINITY\n  options.cylinderAxis = options.cylinderAxis || 'y'\n  options.margin = options.hasOwnProperty('margin') ? options.margin : 0.05\n  options.includeInvisible = options.hasOwnProperty('includeInvisible') ? options.includeInvisible : false\n\n  if (!options.offset) {\n    options.offset = new Vector3()\n  }\n\n  if (!options.orientation) {\n    options.orientation = new Quaternion()\n  }\n}\n\nconst _finishCollisionShape = function (collisionShape, options, scale) {\n  collisionShape.type = options.type\n  collisionShape.setMargin(options.margin)\n  collisionShape.destroy = () => {\n    for (let res of collisionShape.resources || []) {\n      Ammo.destroy(res)\n    }\n    if (collisionShape.heightfieldData) {\n      Ammo._free(collisionShape.heightfieldData)\n    }\n    Ammo.destroy(collisionShape)\n  }\n\n  // const localTransform = new Ammo.btTransform()\n  // const rotation = new Ammo.btQuaternion()\n  // localTransform.setIdentity()\n\n  // localTransform.getOrigin().setValue(options.offset.x, options.offset.y, options.offset.z)\n  // rotation.setValue(options.orientation.x, options.orientation.y, options.orientation.z, options.orientation.w)\n\n  // localTransform.setRotation(rotation)\n  // Ammo.destroy(rotation)\n\n  if (scale) {\n    const localScale = new Ammo.btVector3(scale.x, scale.y, scale.z)\n    collisionShape.setLocalScaling(localScale)\n    Ammo.destroy(localScale)\n  }\n\n  // collisionShape.localTransform = localTransform\n}\n\n// Calls `cb(geo, transform)` for each geometry under `root` whose vertices we should take into account for the physics shape.\n// `transform` is the transform required to transform the given geometry's vertices into root-local space.\nconst _iterateGeometries = (function () {\n  const transform = new Matrix4()\n  const inverse = new Matrix4()\n  const bufferGeometry = new BufferGeometry()\n  return function (root, options, cb) {\n    inverse.getInverse(root.matrixWorld)\n    root.traverse(mesh => {\n      if (\n        mesh.isMesh /*&&\n        (!Sky || mesh.__proto__ != Sky.prototype) &&\n        (options.includeInvisible || (mesh.el && mesh.el.object3D.visible) || mesh.visible)*/\n      ) {\n        if (mesh === root) {\n          transform.identity()\n        } else {\n          if (hasUpdateMatricesFunction) mesh.updateMatrices()\n          transform.multiplyMatrices(inverse, mesh.matrixWorld)\n        }\n        // todo: might want to return null xform if this is the root so that callers can avoid multiplying\n        // things by the identity matrix\n        cb(mesh.geometry.isBufferGeometry ? mesh.geometry : bufferGeometry.fromGeometry(mesh.geometry), transform)\n      }\n    })\n  }\n})()\n\nconst _computeScale = function (root, options) {\n  // const scale = new Vector3(1, 1, 1)\n  // if (options.fit === FIT.ALL) {\n  //   scale.setFromMatrixScale(root.matrixWorld)\n  // }\n  // return scale\n  const { scale } = root\n  return scale\n}\n\nconst _computeRadius = (function () {\n  const v = new Vector3()\n  const center = new Vector3()\n  return function (root, options, bounds) {\n    let maxRadiusSq = 0\n    let { x: cx, y: cy, z: cz } = bounds.getCenter(center)\n    _iterateGeometries(root, options, (geo, transform) => {\n      const components = geo.attributes.position.array\n      for (let i = 0; i < components.length; i += 3) {\n        v.set(components[i], components[i + 1], components[i + 2]).applyMatrix4(transform)\n        const dx = cx - v.x\n        const dy = cy - v.y\n        const dz = cz - v.z\n        maxRadiusSq = Math.max(maxRadiusSq, dx * dx + dy * dy + dz * dz)\n      }\n    })\n    return Math.sqrt(maxRadiusSq)\n  }\n})()\n\nconst _computeHalfExtents = function (root, bounds, minHalfExtent, maxHalfExtent) {\n  const halfExtents = new Vector3()\n  return halfExtents.subVectors(bounds.max, bounds.min).multiplyScalar(0.5).clampScalar(minHalfExtent, maxHalfExtent)\n}\n\nconst _computeLocalOffset = function (matrix, bounds, target) {\n  target.addVectors(bounds.max, bounds.min).multiplyScalar(0.5).applyMatrix4(matrix)\n  return target\n}\n\n// returns the bounding box for the geometries underneath `root`.\nconst _computeBounds = (function () {\n  const v = new Vector3()\n  return function (root, options) {\n    const bounds = new Box3()\n    let minX = +Infinity\n    let minY = +Infinity\n    let minZ = +Infinity\n    let maxX = -Infinity\n    let maxY = -Infinity\n    let maxZ = -Infinity\n    bounds.min.set(0, 0, 0)\n    bounds.max.set(0, 0, 0)\n    _iterateGeometries(root, options, (geo, transform) => {\n      const components = geo.attributes.position.array\n      for (let i = 0; i < components.length; i += 3) {\n        v.set(components[i], components[i + 1], components[i + 2]).applyMatrix4(transform)\n        if (v.x < minX) minX = v.x\n        if (v.y < minY) minY = v.y\n        if (v.z < minZ) minZ = v.z\n        if (v.x > maxX) maxX = v.x\n        if (v.y > maxY) maxY = v.y\n        if (v.z > maxZ) maxZ = v.z\n      }\n    })\n    bounds.min.set(minX, minY, minZ)\n    bounds.max.set(maxX, maxY, maxZ)\n    return bounds\n  }\n})()\n\n// adjusts the translate of the geometry\n// https://threejs.org/docs/#api/en/core/BufferGeometry.translate\nconst adjustGeometryTranslateEXPERIMENTAL = (geo, transform) => {\n  geo.computeBoundingBox()\n  const target = new Vector3()\n  geo.boundingBox.getCenter(target)\n  transform.makeTranslation(target.x, target.y, target.z)\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport { Quaternion } from '@enable3d/three-wrapper/dist/index'\n\n// https://pybullet.org/Bullet/phpBB3/viewtopic.php?t=7228\nexport const addTorusShape = (config: { radius: number; tube: number; tubularSegments: number }, quat: Quaternion) => {\n  const { radius = 1, tube = 0.4, tubularSegments = 8 } = config\n\n  const SIMD_PI = Math.PI\n  const subdivisions = tubularSegments\n  const gap = Math.sqrt(2.0 * tube * tube - 2.0 * tube * tube * Math.cos((2.0 * SIMD_PI) / subdivisions))\n\n  const btHalfExtents = new Ammo.btVector3(tube, SIMD_PI / subdivisions + 0.5 * gap, tube)\n  const cylinderShape = new Ammo.btCylinderShape(btHalfExtents)\n  cylinderShape.setMargin(0.05)\n\n  const compoundShape = new Ammo.btCompoundShape()\n\n  const forward = new Ammo.btVector3(0, 0, 1)\n  const side = new Ammo.btVector3(0, radius, 0)\n  const rotation = new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w)\n\n  for (let x = 0; x < subdivisions; x++) {\n    const angle = (x * 2.0 * SIMD_PI) / subdivisions\n    const position = side.rotate(forward, angle)\n    const transform = new Ammo.btTransform()\n    rotation.setRotation(forward, angle + Math.PI / 2)\n    transform.setIdentity()\n    transform.setOrigin(position)\n    transform.setRotation(rotation)\n    compoundShape.addChildShape(transform, cylinderShape)\n  }\n\n  return compoundShape\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport Physics from '../physics'\nimport { ExtendedObject3D } from '@enable3d/common/dist/types'\n\nexport default class ClosestRayResultCallback {\n  protected _tmpBtVector3: Ammo.btVector3\n  protected _btRayCallback: Ammo.ClosestRayResultCallback\n\n  constructor(protected physics: Physics) {}\n\n  getHitPointWorld(): { x: number; y: number; z: number } {\n    const h = this._btRayCallback.get_m_hitPointWorld() as Ammo.btVector3\n\n    const point = { x: h.x(), y: h.y(), z: h.z() }\n\n    return point\n  }\n\n  getCollisionObject(): ExtendedObject3D {\n    const getPtr = (obj: any) => {\n      return Object.values(obj)[0]\n    }\n\n    const ptr = getPtr(this._btRayCallback.get_m_collisionObject())\n    // @ts-ignore\n    return this.physics.objectsAmmo[ptr]\n  }\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport Physics from '../physics'\nimport { ExtendedObject3D } from '@enable3d/common/dist/types'\n\nexport default class AllHitsRayResultCallback {\n  protected _tmpBtVector3: Ammo.btVector3\n  protected _btRayCallback: Ammo.AllHitsRayResultCallback\n\n  constructor(protected physics: Physics) {}\n\n  getHitPointWorld(): { x: number; y: number; z: number }[] {\n    const h = this._btRayCallback.get_m_hitPointWorld() as Ammo.btVector3Array\n\n    const points = []\n    for (let i = h.size() - 1; i >= 0; i--) {\n      const hh = h.at(i)\n      points.push({ x: hh.x(), y: hh.y(), z: hh.z() })\n    }\n\n    return points\n  }\n\n  getCollisionObjects(): ExtendedObject3D[] {\n    const getPtr = (obj: any) => {\n      return Object.values(obj)[0]\n    }\n\n    const obs = []\n    // @ts-ignore\n    const o = this._btRayCallback.get_m_collisionObjects()\n    for (let i = o.size() - 1; i >= 0; i--) {\n      const ptr = getPtr(o.at(i))\n      // @ts-ignore\n      obs.push(this.physics.objectsAmmo[ptr])\n    }\n    return obs\n  }\n}\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport Physics from '../physics'\nimport applyMixins from '@enable3d/common/dist/applyMixins'\nimport ClosestRayResultCallback from './closestRayResultCallback'\nimport AllHitsRayResultCallback from './allHitsRayResultCallback'\n\nclass Raycaster {\n  protected _tmpBtVector3: Ammo.btVector3\n  protected _btRayFrom: Ammo.btVector3\n  protected _btRayTo: Ammo.btVector3\n  protected _btRayCallback: any\n  protected initCallback: any\n\n  constructor(protected physics: Physics) {}\n\n  setRayFromWorld(x = 0, y = 0, z = 0) {\n    this._btRayFrom.setValue(x, y, z)\n    this._btRayCallback.set_m_rayFromWorld(this._btRayFrom)\n  }\n\n  setRayToWorld(x = 0, y = 0, z = 0) {\n    this._btRayTo.setValue(x, y, z)\n    this._btRayCallback.set_m_rayToWorld(this._btRayTo)\n  }\n\n  hasHit() {\n    return this._btRayCallback.hasHit()\n  }\n\n  rayTest() {\n    this.physics.physicsWorld.rayTest(this._btRayFrom, this._btRayTo, this._btRayCallback)\n  }\n\n  destroy() {\n    Ammo.destroy(this._tmpBtVector3)\n    Ammo.destroy(this._btRayFrom)\n    Ammo.destroy(this._btRayTo)\n    Ammo.destroy(this._btRayCallback)\n  }\n}\n\ninterface ClosestRaycaster extends Raycaster, ClosestRayResultCallback {}\ninterface AllHitsRaycaster extends Raycaster, AllHitsRayResultCallback {}\n\nclass ClosestRaycaster {\n  protected _tmpBtVector3: Ammo.btVector3 = new Ammo.btVector3(0, 0, 0)\n  protected _btRayFrom = new Ammo.btVector3(0, 0, 0)\n  protected _btRayTo = new Ammo.btVector3(0, 0, 0)\n\n  protected _btRayCallback: Ammo.ClosestRayResultCallback = new Ammo.ClosestRayResultCallback(\n    this._tmpBtVector3,\n    this._tmpBtVector3\n  )\n\n  constructor(protected physics: Physics) {}\n}\n\nclass AllHitsRaycaster {\n  protected _tmpBtVector3: Ammo.btVector3 = new Ammo.btVector3(0, 0, 0)\n  protected _btRayFrom = new Ammo.btVector3(0, 0, 0)\n  protected _btRayTo = new Ammo.btVector3(0, 0, 0)\n\n  protected _btRayCallback: Ammo.AllHitsRayResultCallback = new Ammo.AllHitsRayResultCallback(\n    this._tmpBtVector3,\n    this._tmpBtVector3\n  )\n\n  constructor(protected physics: Physics) {}\n}\n\napplyMixins(ClosestRaycaster, [Raycaster, ClosestRayResultCallback])\napplyMixins(AllHitsRaycaster, [Raycaster, AllHitsRayResultCallback])\n\nexport { ClosestRaycaster, AllHitsRaycaster }\n","/**\n * @author yandeu\n * @description Ported to TypeScript\n */\n\n/**\n * @author alteredq / http://alteredqualia.com/\n */\n\n/**\n * This is the Clock class THREE provides.\n */\nclass Clock {\n  autoStart: boolean\n  startTime: number\n  oldTime: number\n  elapsedTime: number\n  running: boolean\n\n  constructor(autoStart = true) {\n    this.autoStart = autoStart !== undefined ? autoStart : true\n    this.startTime = 0\n    this.oldTime = 0\n    this.elapsedTime = 0\n    this.running = false\n  }\n\n  start() {\n    this.startTime = (typeof performance === 'undefined' ? Date : performance).now() // see #10732\n\n    this.oldTime = this.startTime\n    this.elapsedTime = 0\n    this.running = true\n  }\n\n  stop() {\n    this.getElapsedTime()\n    this.running = false\n    this.autoStart = false\n  }\n\n  getElapsedTime() {\n    this.getDelta()\n    return this.elapsedTime\n  }\n\n  getDelta() {\n    let diff = 0\n\n    if (this.autoStart && !this.running) {\n      this.start()\n      return 0\n    }\n\n    if (this.running) {\n      let newTime = (typeof performance === 'undefined' ? Date : performance).now()\n\n      diff = (newTime - this.oldTime) / 1000\n      this.oldTime = newTime\n\n      this.elapsedTime += diff\n    }\n\n    return diff\n  }\n}\n\nexport { Clock }\n","/**\n * @author       Yannick Deubel (https://github.com/yandeu)\n * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/enable3d/enable3d\n * @license      {@link https://github.com/enable3d/enable3d/blob/master/LICENSE|GNU GPLv3}\n */\n\nimport logger from '@enable3d/common/dist/logger'\nimport PhysicsBody from '@enable3d/common/dist/physicsBody'\n\nimport applyMixins from '@enable3d/common/dist/applyMixins'\n\nimport { ExtendedObject3D } from '@enable3d/common/dist/extendedObject3D'\nexport { ExtendedObject3D }\n\nimport { ExtendedMesh } from '@enable3d/common/dist/extendedMesh'\nexport { ExtendedMesh }\n\nimport Shapes from './shapes'\nimport Constraints from './constraints'\nimport Events from './events'\nimport EventEmitter from 'eventemitter3'\nimport Physics from './physics'\nimport { Vector3, Quaternion, Scene, Mesh, Euler } from '@enable3d/three-wrapper/dist/index'\nimport { createCollisionShapes } from './three-to-ammo'\nimport { addTorusShape } from './torusShape'\nimport Factories from '@enable3d/common/dist/factories'\nimport { REVISION } from '@enable3d/three-wrapper/dist/index'\n\nimport { PhysicsLoader } from '@enable3d/common/dist/physicsLoader'\nimport DefaultMaterial from '@enable3d/common/dist/defaultMaterial'\nexport { PhysicsLoader }\n\nimport * as Types from '@enable3d/common/dist/types'\nimport { ClosestRaycaster, AllHitsRaycaster } from './raycaster/raycaster'\nexport { ClosestRaycaster, AllHitsRaycaster }\nexport { Types }\n\n// Export THREE.Clock\nexport { Clock } from './lib/Clock'\n\ninterface AmmoPhysics extends Physics, Constraints, Shapes, Events {}\n\nclass AmmoPhysics extends EventEmitter {\n  public tmpTrans: Ammo.btTransform\n  public factory: Factories\n  public isHeadless: boolean\n\n  public rigidBodies: ExtendedObject3D[] = []\n  public objectsAmmo: { [ptr: number]: ExtendedObject3D } = {}\n  protected earlierDetectedCollisions: { combinedName: string; collision: boolean }[] = []\n  protected gravity: { x: number; y: number; z: number }\n\n  protected tmpEuler: Euler\n  protected tmpQuaternion: Quaternion\n  protected tmpVector3: Vector3\n  protected tmpBtVector3: Ammo.btVector3\n  protected tmpBtQuaternion: Ammo.btQuaternion\n\n  protected defaultMaterial: DefaultMaterial\n\n  constructor(public scene: Scene | 'headless', public config: Types.ThreeGraphicsConfig = {}) {\n    super()\n\n    this.isHeadless = scene === 'headless' ? true : false\n    this.tmpEuler = new Euler()\n    this.tmpQuaternion = new Quaternion()\n    this.tmpVector3 = new Vector3()\n    this.tmpBtVector3 = new Ammo.btVector3()\n    this.tmpBtQuaternion = new Ammo.btQuaternion(0, 0, 0, 1)\n\n    if (scene !== 'headless') {\n      this.defaultMaterial = new DefaultMaterial()\n\n      const version = `three.js version ${REVISION}`\n      console.log(\n        `%c %c %c %c %c ${version} %c https://threejs.org/`,\n        'background: #ff0000',\n        'background: #ffff00',\n        'background: #00ff00',\n        'background: #00ffff',\n        'color: #fff; background: #000000;',\n        'background: none'\n      )\n    }\n\n    this.factory = new Factories(scene)\n\n    this.emptyV3 = new Vector3()\n    this.impactPoint = new Vector3()\n    this.impactNormal = new Vector3()\n\n    this.gravity = config.gravity || { x: 0, y: -9.81, z: 0 }\n\n    this.start()\n  }\n\n  public get debug() {\n    if (this.isHeadless) return null\n\n    return {\n      enable: () => {\n        this.debugDrawer.enable()\n      },\n      mode: (debugMode: number = 1) => {\n        this.debugDrawer.setDebugMode(debugMode)\n      },\n      disable: () => {\n        this.debugDrawer.disable()\n      }\n    }\n  }\n\n  private start() {\n    if (typeof Ammo === 'undefined') {\n      logger('Are you sure you included ammo.js?')\n      return\n    }\n\n    if (typeof Ammo === 'function')\n      Ammo().then(() => {\n        this.setup()\n      })\n    else this.setup()\n  }\n\n  public get add() {\n    return {\n      collider: (\n        object1: ExtendedObject3D,\n        object2: ExtendedObject3D,\n        eventCallback: (event: 'start' | 'collision' | 'end') => void\n      ) => this.addCollider(object1, object2, eventCallback),\n      constraints: this.addConstraints,\n      existing: (object: ExtendedObject3D, config?: Types.AddExistingConfig) => this.addExisting(object, config),\n      plane: (planeConfig: Types.PlaneConfig = {}, materialConfig: Types.MaterialConfig = {}) =>\n        this.addPlane(planeConfig, materialConfig),\n      sphere: (sphereConfig: Types.SphereConfig = {}, materialConfig: Types.MaterialConfig = {}) =>\n        this.addSphere(sphereConfig, materialConfig),\n      ground: (groundConfig: Types.GroundConfig = {}, materialConfig: Types.MaterialConfig = {}) =>\n        this.addGround(groundConfig, materialConfig),\n      box: (boxConfig: Types.BoxConfig = {}, materialConfig: Types.MaterialConfig = {}) =>\n        this.addBox(boxConfig, materialConfig),\n      cylinder: (cylinderConfig: Types.CylinderConfig = {}, materialConfig: Types.MaterialConfig = {}) =>\n        this.addCylinder(cylinderConfig, materialConfig),\n      cone: (coneConfig: Types.ConeConfig = {}, materialConfig: Types.MaterialConfig = {}) =>\n        this.addCone(coneConfig, materialConfig),\n      torus: (torusConfig: Types.TorusConfig = {}, materialConfig: Types.MaterialConfig = {}) =>\n        this.addTorus(torusConfig, materialConfig),\n      extrude: (extrudeConfig: Types.ExtrudeConfig, materialConfig: Types.MaterialConfig = {}) =>\n        this.addExtrude(extrudeConfig, materialConfig),\n      /**\n       * Creates a new Raycaster\n       * @param type Returns only the closes body by default. Can be 'closest' or 'allHits'.\n       */\n      raycaster: (type = 'closest') => {\n        if (type === 'closest') return new ClosestRaycaster(this) as ClosestRaycaster\n        else return new AllHitsRaycaster(this) as AllHitsRaycaster\n      }\n    }\n  }\n\n  // public addCompoundShape(shapes: any) {\n  //   const compoundShape = new Ammo.btCompoundShape()\n  //   shapes.forEach((obj: any, i: number) => {\n  //     const transform = new Ammo.btTransform()\n\n  //     const pos = new Vector3(obj.x || 0, obj.y || 0, obj.z || 0)\n  //     if (obj.tmp?.offset) {\n  //       const o = obj.tmp.offset\n  //       pos.add(new Vector3(o.x, o.y, o.z))\n  //     }\n  //     transform.setIdentity()\n  //     transform.setOrigin(new Ammo.btVector3(pos.x || 0, pos.y || 0, pos.z || 0))\n  //     // TODO add rotation\n  //     // transform.setRotation(new Ammo.btQuaternion(quat.x || 0, quat.y || 0, quat.z || 0, quat.w || 1))\n  //     compoundShape.addChildShape(transform, shapes[i])\n  //   })\n  //   return compoundShape\n  // }\n\n  private prepareThreeObjectForCollisionShape(object: ExtendedObject3D, config: Types.AddExistingConfig = {}) {\n    const { position: pos, quaternion: quat, hasBody } = object\n    const { autoCenter = false } = config\n\n    // set default params\n    const defaultParams = {\n      width: 1,\n      height: 1,\n      depth: 1,\n      radius: 1,\n      radiusTop: 1, // for the cylinder\n      radiusBottom: 1, // for the cylinder\n      tube: 0.4, // for the torus\n      tubularSegments: 6 // for the torus\n    }\n\n    // determine the shape (fallback to hacd)\n    let shape: string = 'unknown'\n    // retrieve the shape from the geometry\n    const type = object.geometry?.type || 'unknown'\n    if (/box/i.test(type)) shape = 'box'\n    else if (/cone/i.test(type)) shape = 'cone'\n    else if (/cylinder/i.test(type)) shape = 'cylinder'\n    else if (/extrude/i.test(type)) shape = 'extrude'\n    else if (/plane/i.test(type)) shape = 'plane'\n    else if (/sphere/i.test(type)) shape = 'sphere'\n    else if (/torus/i.test(type)) shape = 'torus'\n\n    // @ts-ignore\n    let params = { ...defaultParams, ...object?.geometry?.parameters }\n\n    if (config.shape) {\n      params = { ...defaultParams, ...config }\n      shape = config.shape\n    } else if (object.shape) {\n      shape = object.shape\n    }\n\n    // Add all default params if undefined\n    Object.keys(params).forEach(key => {\n      // @ts-ignore\n      if (typeof params[key] === 'undefined' && defaultParams[key]) {\n        // @ts-ignore\n        params[key] = defaultParams[key]\n      }\n    })\n\n    // auto adjust the center for custom shapes\n    if (autoCenter) object.geometry.center()\n\n    // some aliases\n    if (shape === 'extrude') shape = 'hacd'\n    if (shape === 'mesh' || shape === 'convex') shape = 'convexMesh'\n    if (shape === 'concave') shape = 'concaveMesh'\n\n    // if we have not found a shape until here, we fallback to 'box'\n    if (shape === 'unknown') {\n      logger(`Shape for ${object?.name} not recognized! Will fallback to box.`)\n      shape = 'box'\n    }\n\n    return { shape, params, object }\n  }\n\n  public createCollisionShape(shape: string, params: any, object?: ExtendedObject3D): Ammo.btCollisionShape {\n    const quat = object?.quaternion ? object?.quaternion : new Quaternion(0, 0, 0, 1)\n\n    let collisionShape\n    switch (shape) {\n      case 'box':\n        collisionShape = new Ammo.btBoxShape(new Ammo.btVector3(params.width / 2, params.height / 2, params.depth / 2))\n        break\n      case 'sphere':\n        collisionShape = new Ammo.btSphereShape(params.radius)\n        break\n      case 'cylinder':\n        collisionShape = new Ammo.btCylinderShape(new Ammo.btVector3(params.radiusTop, params.height / 2, 0))\n        break\n      case 'cone':\n        collisionShape = new Ammo.btConeShape(params.radius, params.height)\n        break\n      case 'torus':\n        collisionShape = addTorusShape(params, quat)\n        break\n      case 'capsule':\n        collisionShape = new Ammo.btCapsuleShape(params.radius, params.height)\n        break\n      case 'plane':\n        collisionShape = createCollisionShapes(object, { type: 'mesh', concave: false })\n        break\n      case 'hull':\n        collisionShape = createCollisionShapes(object, { type: 'hull' })\n        break\n      case 'hacd':\n        collisionShape = createCollisionShapes(object, { type: 'hacd' })\n        break\n      case 'vhacd':\n        collisionShape = createCollisionShapes(object, { type: 'vhacd' })\n        break\n      case 'convexMesh':\n        collisionShape = createCollisionShapes(object, { type: 'mesh', concave: false })\n        break\n      case 'concaveMesh':\n        collisionShape = createCollisionShapes(object, { type: 'mesh', concave: true })\n        break\n    }\n\n    // if there is a x, y or z, take is as temporary offset parameter\n    const { x, y, z } = params\n    if (x || y || z) {\n      // @ts-ignore\n      collisionShape.offset = { x: x || 0, y: y || 0, z: z || 0 }\n    }\n\n    // in some cases, like hacd, it will be an array of shapes\n    // so we merge them\n    if (Array.isArray(collisionShape)) collisionShape = this.mergeCollisionShapesToCompoundShape(collisionShape)\n\n    return collisionShape as Ammo.btCollisionShape\n  }\n\n  public mergeCollisionShapesToCompoundShape(collisionShapes: Ammo.btCollisionShape[]): Ammo.btCompoundShape {\n    const compoundShape = new Ammo.btCompoundShape()\n    collisionShapes.forEach(shape => {\n      // @ts-ignore\n      const { offset } = shape // offset is a custom parameter\n\n      const transform = new Ammo.btTransform()\n      transform.setIdentity()\n      if (offset) transform.setOrigin(new Ammo.btVector3(offset.x || 0, offset.y || 0, offset.z || 0))\n      compoundShape.addChildShape(transform, shape)\n    })\n    return compoundShape\n  }\n\n  protected addExisting(object: ExtendedObject3D, config: Types.AddExistingConfig = {}): any {\n    const { hasBody } = object\n    if (hasBody) {\n      console.warn(`[Enable3d]: Object \"${object.name}\" already has a physical body!`)\n      return\n    }\n\n    const { position: pos, quaternion: quat } = object\n    const {\n      shape = 'unknown',\n      compound = [],\n      mass = 1,\n      collisionFlags = 0,\n      offset = undefined,\n      breakable = false,\n      addChildren = true\n    } = config\n\n    if (compound.length >= 1) {\n      // if we want a custom compound shape, we simply do\n      const collisionShapes = compound.map((s: any) => this.createCollisionShape(s.shape, s))\n      const compoundShape = this.mergeCollisionShapesToCompoundShape(collisionShapes)\n      const rigidBody = this.collisionShapeToRigidBody(compoundShape, object.position, object.quaternion, 1)\n      this.addRigidBodyToWorld(object, rigidBody)\n      return\n    }\n\n    const collisionShapes: Ammo.btCollisionShape[] = []\n\n    // if object is a THREE.Group, object does not have a mesh\n    if (shape !== 'unknown' || object.isMesh) {\n      const p = this.prepareThreeObjectForCollisionShape(object, config)\n      const cs = this.createCollisionShape(p.shape, p.params, p.object)\n      collisionShapes.push(cs)\n    }\n\n    // check if the object has children\n    if (shape === 'unknown' && addChildren && object.children.length >= 1) {\n      object.children.forEach((child: any) => {\n        if (child.isMesh) {\n          const p = this.prepareThreeObjectForCollisionShape(child)\n          const cs = this.createCollisionShape(p.shape, p.params, p.object)\n          // @ts-ignore\n          cs.offset = child.position.clone() // this is relative position to its parent\n          collisionShapes.push(cs)\n        }\n      })\n    }\n\n    const collisionShape =\n      collisionShapes.length === 1 ? collisionShapes[0] : this.mergeCollisionShapesToCompoundShape(collisionShapes)\n\n    // add rigid body\n    // object.position.copy(pos)\n    // object.quaternion.copy(quat)\n\n    const rigidBody = this.collisionShapeToRigidBody(collisionShape, pos, quat, mass)\n\n    // const scale = { x: 1, y: 1, z: 1 }\n    // if (scale) {\n    //   const localScale = new Ammo.btVector3(scale.x, scale.y, scale.z)\n    //   Shape.setLocalScaling(localScale)\n    //   Ammo.destroy(localScale)\n    // }\n\n    this.addRigidBodyToWorld(object, rigidBody, collisionFlags, breakable, offset)\n  }\n\n  public addRigidBodyToWorld(\n    object: ExtendedObject3D,\n    rigidBody: Ammo.btRigidBody,\n    collisionFlags = 0,\n    breakable?: boolean,\n    offset?: { x?: number; y?: number; z?: number }\n  ) {\n    this.rigidBodies.push(object)\n    this.physicsWorld.addRigidBody(rigidBody)\n\n    const ptr = Object.values(rigidBody)[0]\n    // @ts-ignore\n    rigidBody.name = object.name\n    object.body = new PhysicsBody(this, rigidBody)\n    object.hasBody = true\n    // @ts-ignore\n    object.ptr = ptr\n    this.objectsAmmo[ptr] = object\n\n    if (breakable) object.body.breakable = true\n    if (offset) object.body.offset = { x: 0, y: 0, z: 0, ...offset }\n\n    object.body.setCollisionFlags(collisionFlags)\n  }\n\n  // protected getShape(shape: any, shapes: any, children: any, params: any, object: any, quat: any) {\n  //   let Shape: Ammo.btConvexShape\n\n  //   // combine multiple shapes to one compound shape\n  //   if (shapes.length > 0) {\n  //     const tmp: any[] = [] // stores all the raw shapes\n\n  //     shapes.forEach((obj: any) => {\n  //       const s = this.addShape({ shape: obj.shape, params: { ...obj } })\n  //       // @ts-ignore\n  //       s.tmp = { offset: { x: obj.x || 0, y: obj.y || 0, z: obj.z || 0 } }\n  //       // TODO add rotation as well\n  //       tmp.push(s)\n  //     })\n\n  //     Shape = this.addCompoundShape(tmp)\n  //   } else {\n  //     Shape = this.addShape({ shape, shapes, params, object, quat })\n  //   }\n\n  //   if (!Shape) {\n  //     logger(`Could not recognize shape \"${shape}\"!`)\n  //     return\n  //   }\n\n  //   if (children.length >= 1) {\n  //     Shape = this.addCompoundShape([Shape, ...children])\n  //   }\n\n  //   Shape.setMargin(0.05)\n\n  //   return Shape as Ammo.btConvexShape\n  // }\n\n  // public addRigidBodyToShape(object: any, Shape: any, options: any) {\n  //   const {\n  //     mass = 1,\n  //     pos = new Vector3(0, 0, 0),\n  //     quat = new Quaternion(0, 0, 0, 1),\n  //     breakable = false,\n  //     offset = { x: 0, y: 0, z: 0 },\n  //     config = {}\n  //   } = options\n  //   this.addRigidBody(object, Shape, mass, pos, quat)\n  //   this.addBodyProperties(object, config)\n\n  //   if (breakable) object.body.breakable = true\n  //   if (offset) object.body.offset = { x: 0, y: 0, z: 0, ...offset }\n  // }\n\n  // private addShape(opts: any) {\n  //   const { shape, object, params, quat } = opts\n  // }\n\n  public collisionShapeToRigidBody(\n    physicsShape: Ammo.btCollisionShape,\n    pos: Vector3,\n    quat: Quaternion,\n    mass: number = 1\n  ) {\n    const transform = new Ammo.btTransform()\n    transform.setIdentity()\n    transform.setOrigin(new Ammo.btVector3(pos.x, pos.y, pos.z))\n    transform.setRotation(new Ammo.btQuaternion(quat.x, quat.y, quat.z, quat.w))\n    const motionState = new Ammo.btDefaultMotionState(transform)\n    const localInertia = new Ammo.btVector3(0, 0, 0)\n    if (mass > 0) physicsShape.calculateLocalInertia(mass, localInertia)\n    const rbInfo = new Ammo.btRigidBodyConstructionInfo(mass, motionState, physicsShape, localInertia)\n    const rigidBody = new Ammo.btRigidBody(rbInfo)\n    if (mass > 0) rigidBody.setActivationState(4) // Disable deactivation\n    return rigidBody\n  }\n}\n\napplyMixins(AmmoPhysics, [Physics, Constraints, Shapes, Events])\n\nexport { AmmoPhysics }\n","/**\n * To create the UMD bundle\n */\nexport * from './index'\n\n// import * as THREE from '@enable3d/three-wrapper/dist/index'\n// export { THREE }\n"],"sourceRoot":""}